; Script generated by the Inno Setup Script Wizard.
; SEE THE DOCUMENTATION FOR DETAILS ON CREATING INNO SETUP SCRIPT FILES!

#define MyAppName "中国银行批量文件制作工具"
#define MyAppVersion "1.0.1"
#define MyAppPublisher "IBM"
#define MyAppExeName "BOC_BATCH_TOOL.exe"
#define IncludeFramework true
#define IsExternal ""
#define SourcePath "C:\Projects\企业\branches\p501BatchTool\制作安装包"

[Setup]
; NOTE: The value of AppId uniquely identifies this application.
; Do not use the same AppId value in installers for other applications.
; (To generate a new GUID, click Tools | Generate GUID inside the IDE.)
AppId={{B682FABB-17BC-433A-82C1-17E58E6C1845}
AppName={#MyAppName}
AppVersion={#MyAppVersion}
AppVerName={#MyAppName} {#MyAppVersion}
AppPublisher={#MyAppPublisher}
DefaultDirName=C:\Program Files\中国银行\{#MyAppName}
DefaultGroupName={#MyAppName}
OutputDir={#SourcePath}
OutputBaseFilename=BatchTool501
SetupIconFile={#SourcePath}\BOCLOGO.ico
Compression=lzma
SolidCompression=yes
DisableReadyPage=yes
PrivilegesRequired=admin

[Languages]

Name: "chs";MessagesFile: "compiler:Languages\ChineseSimplified.isl"

[Tasks]
Name: "desktopicon"; Description: "{cm:CreateDesktopIcon}"; GroupDescription: "{cm:AdditionalIcons}"; Flags: checkablealone

[Files]
Source: "{#SourcePath}\安装包所需文件\BOC_BATCH_TOOL.exe"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\BOC_UPDATE_ADMIN.exe"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\BOC_UPDATER.exe"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\help.mht"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\References\ICSharpCode.SharpZLib.dll"; DestDir: "{app}"; Flags: onlyifdoesntexist uninsneveruninstall  
;Source: "{#SourcePath}\安装包所需文件\References\Microsoft.Office.Interop.Excel.dll"; DestDir: "{app}"; Flags: onlyifdoesntexist uninsneveruninstall
;Source: "{#SourcePath}\安装包所需文件\References\Office.dll"; DestDir: "{app}"; Flags: onlyifdoesntexist uninsneveruninstall 
Source: "{#SourcePath}\安装包所需文件\Data\BankInfo.xml"; DestDir: "{app}\Data"; Flags: onlyifdoesntexist uninsneveruninstall 
Source: "{#SourcePath}\安装包所需文件\Data\CNAPS.XML"; DestDir: "{app}\Data"; Flags: onlyifdoesntexist uninsneveruninstall 
Source: "{#SourcePath}\安装包所需文件\Data\CNAPSC.XML"; DestDir: "{app}\Data"; Flags: onlyifdoesntexist uninsneveruninstall   
Source: "{#SourcePath}\安装包所需文件\Data\CNAPSET.XML"; DestDir: "{app}\Data"; Flags: onlyifdoesntexist uninsneveruninstall 
Source: "{#SourcePath}\安装包所需文件\Data\TTC.XML"; DestDir: "{app}\Data"; Flags: onlyifdoesntexist uninsneveruninstall 
Source: "{#SourcePath}\安装包所需文件\Data\BCS.XML"; DestDir: "{app}\Data"; Flags: onlyifdoesntexist uninsneveruninstall  
Source: "{#SourcePath}\安装包所需文件\en\BOC_BATCH_TOOL.resources.dll"; DestDir: "{app}\en"; Flags: ignoreversion        
Source: "{#SourcePath}\安装包所需文件\zh-CN\BOC_BATCH_TOOL.resources.dll"; DestDir: "{app}\zh-CN"; Flags: ignoreversion  
Source: "{#SourcePath}\安装包所需文件\Plugins\BOC_BATCH_TOOL_AGENTEXPRESSIN.dll"; DestDir: "{app}\Plugins"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\Plugins\BOC_BATCH_TOOL_AGENTEXPRESSOUT.dll"; DestDir: "{app}\Plugins"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\Plugins\BOC_BATCH_TOOL_AGENTNORMALIN.dll"; DestDir: "{app}\Plugins"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\Plugins\BOC_BATCH_TOOL_AGENTNORMALOUT.dll"; DestDir: "{app}\Plugins"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\Plugins\BOC_BATCH_TOOL_Converter.dll"; DestDir: "{app}\Plugins"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\Plugins\BOC_BATCH_TOOL_ELECTICKET_AUTOTIPEXCHANGE.dll"; DestDir: "{app}\Plugins"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\Plugins\BOC_BATCH_TOOL_ELECTICKET_BACKEDNOTE.dll"; DestDir: "{app}\Plugins"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\Plugins\BOC_BATCH_TOOL_ELECTICKET_POOL.dll"; DestDir: "{app}\Plugins"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\Plugins\BOC_BATCH_TOOL_ELECTICKET_REMIT.dll"; DestDir: "{app}\Plugins"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\Plugins\BOC_BATCH_TOOL_ELECTICKET_STICKON.dll"; DestDir: "{app}\Plugins"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\Plugins\BOC_BATCH_TOOL_INITIATIVEALLOT.dll"; DestDir: "{app}\Plugins"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\Plugins\BOC_BATCH_TOOL_SETTINGS.dll"; DestDir: "{app}\Plugins"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\Plugins\BOC_BATCH_TOOL_SPPLYFINANCING_APPLYOFFRANCHISERFINANCING.dll"; DestDir: "{app}\Plugins"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\Plugins\BOC_BATCH_TOOL_SPPLYFINANCING_BILLOFDEBTRECEIVABLEPURCHASER.dll"; DestDir: "{app}\Plugins"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\Plugins\BOC_BATCH_TOOL_SPPLYFINANCING_BILLOFDEBTRECEIVABLESELLER.dll"; DestDir: "{app}\Plugins"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\Plugins\BOC_BATCH_TOOL_SPPLYFINANCING_PAYMENTORRECEIPTOFDEBTRECEIVABLE.dll"; DestDir: "{app}\Plugins"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\Plugins\BOC_BATCH_TOOL_SPPLYFINANCING_PURCHASEORDER.dll"; DestDir: "{app}\Plugins"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\Plugins\BOC_BATCH_TOOL_SPPLYFINANCING_PURCHASEORDERMGR.dll"; DestDir: "{app}\Plugins"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\Plugins\BOC_BATCH_TOOL_SPPLYFINANCING_SELLERORDER.dll"; DestDir: "{app}\Plugins"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\Plugins\BOC_BATCH_TOOL_SPPLYFINANCING_SELLERORDERMGR.dll"; DestDir: "{app}\Plugins"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\Plugins\BOC_BATCH_TOOL_TRANSFER_CORPORATION.dll"; DestDir: "{app}\Plugins"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\Plugins\BOC_BATCH_TOOL_TRANSFER_FOREIGNMONERY.dll"; DestDir: "{app}\Plugins"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\Plugins\BOC_BATCH_TOOL_TRANSFER_INDIVIDUAL.dll"; DestDir: "{app}\Plugins"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\Plugins\BOC_BATCH_TOOL_TRANSFER_OVERBANKIN.dll"; DestDir: "{app}\Plugins"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\Plugins\BOC_BATCH_TOOL_TRANSFER_OVERBANKOUT.dll"; DestDir: "{app}\Plugins"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\Plugins\BOC_BATCH_TOOL_TRANSFER_OVERSEA.dll"; DestDir: "{app}\Plugins"; Flags: ignoreversion 
Source: "{#SourcePath}\安装包所需文件\Plugins\BOC_BATCH_TOOL_UNITIVEPAYMENTFC.dll"; DestDir: "{app}\Plugins"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\Plugins\BOC_BATCH_TOOL_UNITIVEPAYMENTRMB.dll"; DestDir: "{app}\Plugins"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\Plugins\BOC_BATCH_TOOL_TRANSFER_PREPROCCESS.dll"; DestDir: "{app}\Plugins"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\Plugins\BOC_BATCH_TOOL_TRANSFER_VIRTUALACCOUNT.dll"; DestDir: "{app}\Plugins"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\Plugins\BOC_BATCH_TOOL_FINANCIALSERVER_REIMBURSEMENT.dll"; DestDir: "{app}\Plugins"; Flags: ignoreversion    
Source: "{#SourcePath}\安装包所需文件\EPPlus.dll"; DestDir: "{app}"; Flags: ignoreversion 
Source: "{#SourcePath}\安装包所需文件\NPOI.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\NPOI.OOXML.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\NPOI.OpenXml4Net.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#SourcePath}\安装包所需文件\NPOI.OpenXmlFormats.dll"; DestDir: "{app}"; Flags: ignoreversion   
Source: "{#SourcePath}\安装包所需文件\CommonClient.dll"; DestDir: "{app}"; Flags: ignoreversion
#if IncludeFramework
Source: "{#SourcePath}\dotNetFx40_Full_x86_x64.exe"; DestDir: "{app}"; Flags: ignoreversion {#IsExternal};
#endif
; NOTE: Don't use "Flags: ignoreversion" on any shared system files

[Icons]
Name: "{group}\{#MyAppName}"; Filename: "{app}\{#MyAppExeName}"
Name: "{group}\{cm:UninstallProgram,{#MyAppName}}"; Filename: "{uninstallexe}"
Name: "{commondesktop}\{#MyAppName}"; Filename: "{app}\{#MyAppExeName}"; Tasks: desktopicon

[Run]
#if !IncludeFramework
Filename: {app}\dotNetFx40_Full_x86_x64.exe; Parameters: "/q:a /c:""install /l /q"""; WorkingDir: {tmp}; Flags: skipifdoesntexist; StatusMsg: "Installing .NET Framework if needed"
#endif
;Filename: {app}\Microsoft.NET\Framework\v4.0.30319\CasPol.exe; Parameters: "-q -machine -remgroup ""{#MyAppName}"""; WorkingDir: {tmp}; Flags: skipifdoesntexist runhidden; StatusMsg: "Setting Program Access Permissions..."
;Filename: {win}\Microsoft.NET\Framework\v4.0.30319\CasPol.exe; Parameters: "-q -machine -addgroup 1.2 -url ""file://{app}/*"" FullTrust -name ""{#MyAppName}"""; WorkingDir: {tmp}; Flags: skipifdoesntexist runhidden; StatusMsg: "Setting Program Access Permissions..."

Filename: "{app}\{#MyAppExeName}"; Description: "{cm:LaunchProgram,{#StringChange(MyAppName, '&', '&&')}}"; Flags: nowait postinstall skipifsilent

[Code]
function InitializeSetup(): Boolean;   
var sVersion: Cardinal;
ResultCode: Integer;

begin
  //Log('InitializeSetup called');
  //Result := MsgBox('InitializeSetup:' #13#13 'Setup is initializing. Do you really want to start setup?', mbConfirmation, MB_YESNO) = idYes;
  //if Result = False then
  //  MsgBox('InitializeSetup:' #13#13 'Ok, bye bye.', mbInformation, MB_OK);

  if RegQueryDWordValue(HKLM, 'SOFTWARE\Microsoft\NET Framework Setup\NDP\v4\Client','Install',sVersion) then
  begin
      Result:=True;
  end
  //if sVersion<>1 then
  //begin
    //if RegQueryDWordValue(HKLM, 'SOFTWARE\Microsoft\NET Framework Setup\NDP\v3.5','Install',sVersion) then
    //if sVersion<>1 then 
    //begin
     //检测3.0
     //if RegQueryDWordValue(HKLM, 'SOFTWARE\Microsoft\NET Framework Setup\NDP\v3.0','Install',sVersion) then
     //if sVersion<>1 then
     //begin
       //检测2.0
       //if RegQueryDWordValue(HKLM, 'SOFTWARE\Microsoft\NET Framework Setup\NDP\v2.0.50727','Install',sVersion) then
       //begin                 
               //Result:=True;                                              
       //end
       else
       begin
          //MsgBox('你的电脑没有安装了.net2.0', mbError,MB_OK);
          ExtractTemporaryFile('dotNetFx40_Full_x86_x64.exe'); 
          Exec(ExpandConstant('{tmp}\dotNetFx40_Full_x86_x64.exe'), '', '', SW_SHOWNORMAL, ewWaitUntilTerminated, ResultCode); 
          Result:=True;
       end
     //end
     //else
     //begin     //3.0
        //Result:=True;
     //end
    //end
    //else 
    //begin       //3.5
        //Result := True;
    //end     
  //end
  //else 
  //begin         //4.0
      //Result := True;
  //end
end;
