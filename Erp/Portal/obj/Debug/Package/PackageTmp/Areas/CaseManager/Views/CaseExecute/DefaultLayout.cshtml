@using CommonService.Model.FlowManager;
@using CommonService.Common;
@model IEnumerable<CommonService.Model.FlowManager.P_Business_flow>
@{
    Layout = null;
}
<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>案件执行</title>
    <link href="/theme/css/jquery-ui.css" rel="stylesheet" type="text/css" />
    <link href="/theme/css/style.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="/theme/js/jquery-1.10.2.js"></script>
    <script type="text/javascript" src="/theme/js/jquery-ui.js"></script>
    <script type="text/javascript" src="/theme/js/jquery.dialogextend.1_0_1.js"></script>
    <script type="text/javascript" src="/theme/js/basedialog.js"></script>
    <script type="text/javascript" src="/theme/js/alertMsg.js"></script>
    <script type="text/javascript" src="/theme/js/alertDialog.js"></script>
    <script type="text/javascript" src="/theme/js/ajaxdone.js"></script>
    <style type="text/css">
        .leftcontent {
            width: 30%;
            /*border: dotted 1px #c7c7c7;*/
            min-height: 745px;
        }

        .rightcontent {
            width: 69%;
        }

        .case_info_table {
            border: dotted 1px #c7c7c7;
        }
        .case_info_table tr {
            border-bottom: dotted 1px #c7c7c7;
        }

            .case_info_table tr.nobottomborder {
                border-bottom: 0px;
            }

        .case_info_table td {
            text-indent: 12px;
            min-height: 26px;
            padding-top: 10px;
            padding-bottom: 10px;
            text-align: left;
            padding-right: 3px;
        }

            .case_info_table td.textindent {
                text-indent: 0px;
            }

        .leftContentPaddingLeft {
            padding-left: 5px;
        }

        .right_top {
        }

        .flow_nav {
            margin-left: 10px;
        }

            .flow_nav span {
                height: 36px;
                line-height: 36px;
                font-size: 14px;
            }

                .flow_nav span.start {
                    width: 20px;
                    display: inline-block;
                }

                .flow_nav span.middle {
                    padding-left: 10px;
                    padding-right: 10px;
                    display: inline-block;
                    color: #fff;
                }

                .flow_nav span.end {
                    width: 20px;
                    display: inline-block;
                }
        /*未开始*/
        .grey_start {
            background: url(../../theme/images/flow/grey_start.png) no-repeat;
        }

        .grey_body {
            background: url(../../theme/images/flow/grey_body.png) repeat-x;
        }

        .grey_end {
            background: url(../../theme/images/flow/grey_end.png) no-repeat;
        }

        .grey_end_grey_start {
            background: url(../../theme/images/flow/grey_end_grey_start.png) no-repeat;
        }

        .grey_end_yellow_start {
            background: url(../../theme/images/flow/grey_end_yellow_start.png) no-repeat;
        }

        .grey_end_blue_start {
            background: url(../../theme/images/flow/grey_end_blue_start.png) no-repeat;
        }

        /*进行中*/
        .yellow_start {
            background: url(../../theme/images/flow/yellow_start.png) no-repeat;
        }

        .yellow_body {
            background: url(../../theme/images/flow/yellow_body.png) repeat-x;
        }

        .yellow_end {
            background: url(../../theme/images/flow/yellow_end.png) no-repeat;
        }

        .yellow_end_grey_start {
            background: url(../../theme/images/flow/yellow_end_grey_start.png) no-repeat;
        }

        .yellow_end_yellow_start {
            background: url(../../theme/images/flow/yellow_end_yellow_start.png) no-repeat;
        }

        .yellow_end_blue_start {
            background: url(../../theme/images/flow/yellow_end_blue_start.png) no-repeat;
        }

        /*已完成*/
        .blue_start {
            background: url(../../theme/images/flow/blue_start.png) no-repeat;
        }

        .blue_body {
            background: url(../../theme/images/flow/blue_body.png) repeat-x;
        }

        .blue_end {
            background: url(../../theme/images/flow/blue_end.png) no-repeat;
        }

        .blue_end_grey_start {
            background: url(../../theme/images/flow/blue_end_grey_start.png) no-repeat;
        }

        .blue_end_yellow_start {
            background: url(../../theme/images/flow/blue_end_yellow_start.png) no-repeat;
        }

        .blue_end_blue_start {
            background: url(../../theme/images/flow/blue_end_blue_start.png) no-repeat;
        }

        .flowNodeSpace {
            margin-bottom: 6px;
        }

        .right_bottom {
            height: 655px;
        }

        a {
            color: blue;
            line-height: 18px;
            display: inline-block;
        }

        .flowDetails {
            width: 340px;
            height: 240px;
            margin-left: 10px;
            display: none;
            border: 1px solid silver;
            background: #e9f8f8;
            position: absolute;
        }

        .flowDetails_2 {
            width: 380px;
            height: 240px;
            margin-top: 0px;
            margin-left: 0px;
            display: none;
            border: 1px solid silver;
            background: #e9f8f8;
        }
        .itab{
            border-bottom:none;
        } .itab ul li a {
            /*border-bottom: solid 1px #d0dee5;*/
            line-height: 37px;
            /*margin-bottom: 18px;*/
        }
            .tabletitle a {
                color: black;
                font-weight: bold;
                font-size: 14px;
                height: 30px;
                line-height: 30px;
            }
        .righttitle{
            border-bottom: solid 3px #66c9f3;
        }
        .casejaqk {
            width: 340px;

        }
            .casejaqk td {
                line-height: 15px;
                padding-top: 10px;
                padding-bottom: 10px;
                padding-left: 10px;
                padding-right: 10px;
                /* text-indent: 11px; */
                /*border-right: dotted 1px #c7c7c7;*/
            }
        .dynamicMark {
            width: 25px;
            height: 20px;
            background-color: red;
            position: absolute;
            color: white;
            line-height: 20px;
            text-indent: 6px;
            border-radius: 10px;
            margin-left:-25px;
            margin-top:-5px;
        }
    </style>
    <script type="text/javascript">
        $(function () {
            //切换子业务流程
            $flow_nav = $('.flow_nav');
            $("span.cursor", $flow_nav).each(function () {
                $(this).click(function (event) {
                    var $this = $(this);
                    var $childrenBusinessFlow = $('#iframe_childreBusinessFlow');
                    var baseurl = $childrenBusinessFlow.attr('baseurl');
                    //替换url参数
                    var switchUrl = baseurl.replace("{sid_Iterm}", $this.attr('businessflowcode'));
                    $childrenBusinessFlow.attr('src', switchUrl);
                });
            });
        });
        //打开自定义表单
        function openOwnDefineForm(businessFlowCode, pkCode, fkType, isAllowOpenCustomerForm, isAllowUserOpenFormsPower, isBusinessFlowForms) {
            if (isAllowOpenCustomerForm == '0') {
                alertMsg.info('只有进行中或已结束的业务流程</br>才可以打开表单！');
                return;
            }
            if (isAllowUserOpenFormsPower == '0') {
                alertMsg.info('您没有打开表单的权限！');
                return;
            }
            if (isBusinessFlowForms == '0') {
                alertMsg.info('该流程中暂未分配任何表单！');
                return;
            }
            //替换url参数
            var switchUrl = "/customerform/formpropertyvalue/layoutroottabs?businessFlowCode=" + businessFlowCode + "&pkCode=" + pkCode + "&fkType=" + fkType;
            _openDialog('业务流程表单', switchUrl, 1300, 790);
        }

        ////双击打开自定义表单
        //function openLayoutroottabs(businessFlowCode, pkCode, fkType, isAllowOpenCustomerForm, isAllowUserOpenFormsPower, isBusinessFlowForms)
        //{
        //    var switchUrl = "/customerform/formpropertyvalue/layoutroottabs?businessFlowCode=" + businessFlowCode + "&pkCode=" + pkCode + "&fkType=" + fkType;
        //    _openDialog('业务流程表单', switchUrl, 1300, 780);
        //}

        $(function () {
            $("a[target=popdialog_owndefine]").each(function () {
                $(this).click(function (event) {
                    event.preventDefault();
                    var $this = $(this);
                    //替换url参数
                    var switchUrl = $this.attr("href");
                    _openDialog($(this).attr("title"), switchUrl, $(this).attr("dialogwidth"), $(this).attr("dialogheight"));
                });
            });
        })
        var nb2 = 0;
        function showfy(val, number) {
            $("#tabDetails_2").hide();
            $("#tabDetails_3").hide();
            $("#tabDetails_4").hide();
            nb1 = 0;
            nb3 = 0;
            nb4 = 0;
            var toplab = getAbsoluteTop("fanyuan");
            var leftlab = getAbsoluteLeft("fanyuan");
            $("#" + val).attr("style", "position:absolute; left:" + (leftlab-397)+ "px; top:" + (toplab-50)+ "px;  border: 1px solid #000000;width:300px; height:180px; background: #e9f8f8;");
            //var xPoint = window.event.clientY;
            //if (xPoint > 400) {
            //    $("#" + val).attr("style", "position:absolute; left:1039px; top:345px;  border: 1px solid #000000;width:300px; height:180px; background: #e9f8f8;");
            //} else {
            //    $("#" + val).attr("style", "position:absolute; left:1039px; top:325px;  border: 1px solid #000000;width:300px; height:180px; background: #e9f8f8;");
            //}

            if (number == 1) {
                if (nb2 == 0) {
                    nb2 = 1;
                    $("#" + val).show();
                } else {
                    nb2 = 0;
                    $("#" + val).hide();
                }

            } else {
                $("#" + val).hide();
            }
        }
        var nb1 = 0;
        function showfy_2(val, number) {
            $("#tabDetails").hide();
            $("#tabDetails_3").hide();
            $("#tabDetails_4").hide();
            nb2 = 0;
            nb3 = 0;
            nb4 = 0;
            var toplab = getAbsoluteTop("lvshi");
            var leftlab = getAbsoluteLeft("lvshi");
            $("#" + val).attr("style", "position:absolute; left:" + (leftlab - 387) + "px; top:" + (toplab-50) + "px;  border: 1px solid #000000;width:300px; height:180px; background: #e9f8f8;overflow: auto;");
            //var xPoint = window.event.clientY;
            //if (xPoint > 430) {
            //    $("#" + val).attr("style", "position:absolute; left:1049px; top:404px;  border: 1px solid #000000;width:300px; height:180px; background: #e9f8f8;overflow: auto;");
            //} else {
            //    $("#" + val).attr("style", "position:absolute; left:1049px; top:327px;  border: 1px solid #000000;width:300px; height:180px; background: #e9f8f8;overflow: auto;");
            //}
            if (number == 1) {
                if (nb1 == 0) {
                    nb1 = 1;
                    $("#" + val).show();
                } else {
                    nb1 = 0;
                    $("#" + val).hide();
                }

            } else {
                $("#" + val).hide();
            }
        }

        function opewh_1(url) {
            _openDialog('法院详情', url, 1200, 600);
        }
        var nb3 = 0;
        function showDeptPerson(val, number) {
            $("#tabDetails").hide();
            $("#tabDetails_2").hide();
            $("#tabDetails_4").hide();
            nb1 = 0;
            nb2 = 0;
            nb4 = 0;
            var toplab = getAbsoluteTop("bumen");
            var leftlab = getAbsoluteLeft("bumen");
            $("#" + val).attr("style", "position:absolute; left:" + (leftlab - 397) + "px; top:" + (toplab-50) + "px;  border: 1px solid #000000;width:300px; height:180px; background: #e9f8f8;");
            //var xPoint = window.event.clientY;

            //if (xPoint > 400) {
            //    $("#" + val).attr("style", "position:absolute; left:1039px; top:325px;  border: 1px solid #000000;width:300px; height:180px; background: #e9f8f8;");
            //} else {
            //    $("#" + val).attr("style", "position:absolute; left:1039px; top:305px;  border: 1px solid #000000;width:300px; height:180px; background: #e9f8f8;");
            //}

            if (number == 1) {
                if (nb3 == 0) {
                    nb3 = 1;
                    $("#" + val).show();
                } else {
                    nb3 = 0;
                    $("#" + val).hide();
                }
            } else {
                $("#" + val).hide();
            }
        }

        var nb4 = 0;
        function showjajy(val, number) {
            $("#tabDetails").hide();
            $("#tabDetails_2").hide();
            $("#tabDetails_3").hide();
            nb1 = 0;
            nb2 = 0;
            nb3 = 0;
            var toplab = getAbsoluteTop("jajy");
            var leftlab = getAbsoluteLeft("jajy");
            $("#" + val).attr("style", "position:absolute; left:" + (leftlab - 635) + "px; top:" + (toplab-120) + "px;  border: 1px solid #000000; height:180px; background: #e9f8f8;overflow: auto;");
            //var xPoint = window.event.clientY;
            //if (xPoint > 430) {
            //    $("#" + val).attr("style", "position:absolute; left:949px; top:500px;  border: 1px solid #000000; height:180px; background: #e9f8f8;overflow: auto;");
            //} else {
            //    $("#" + val).attr("style", "position:absolute; left:949px; top:423px;  border: 1px solid #000000; height:180px; background: #e9f8f8;overflow: auto;");
            //}
            if (number == 1) {
                if (nb4 == 0) {
                    nb4 = 1;
                    $("#" + val).show();
                } else {
                    nb4 = 0;
                    $("#" + val).hide();
                }

            } else {
                $("#" + val).hide();
            }
        }

        function jajyDetails(url) {
            _openDialog('提交纪要详情', url, 900, 700);
        }

        function caseInfo()
        {
            $("#caseDynamic").hide();
            $("#dynamic").removeClass("selected");
            $("#caseInfo").show();
            $("#info").addClass("selected");
        }
        function caseDynamic()
        {
            $("#caseInfo").hide();
            $("#info").removeClass("selected");
            $("#caseDynamic").show();
            $("#dynamic").addClass("selected");
        }
        function omover_entryChange(obj, id, client_url) {
            $.ajax({
                type: "POST",
                async: true,
                url: client_url,
                success: function (result) {
                    $("#" + id).html(result);
                }
            })

            var toplab = getAbsoluteTop(obj);
            var leftlab = getAbsoluteLeft(obj);

            //初始化
            $("#entityChangeDetails").css("display", "none");
            $("#entityChangeDetails").attr("trlabid", obj);
            $("#entityChangeDetails").attr("trid", id);
            $("#entityChangeDetails").attr("client_url", client_url);

            var objDiv = $("#" + id + "");
            var xPoint = window.event.clientX;
            objDiv.attr("style", "position:absolute; left:" + (leftlab - 625) + "px; top:" + (toplab+15) + "px; overflow: auto;background-color:white; border: 1px solid #000000; height:180px;width:900px");
            $(objDiv).css("display", "block");
        }
        //影藏进程条目变更信息容器
        function omout_entryChange() {
            $("#entityChangeDetails").hide();
        }
        function omover2(val) {
            var objDiv = $("#" + $(val).attr("trid") + "");
            $(objDiv).css("display", "block");
        }
        function omout_Tj(val) {
            var objDiv = $("#" + $(val).attr("trid") + "");
            $(objDiv).css("display", "none");
        }
        //获取控件左绝对位置
        function getAbsoluteLeft(objectId) {
            var lo = document.getElementById(objectId)
            oLeft = lo.offsetLeft
            while (lo.offsetParent != null) {
                oParent = lo.offsetParent
                oLeft += oParent.offsetLeft
                lo = oParent
            }
            return oLeft
        }
        //获取控件上绝对位置
        function getAbsoluteTop(objectId) {
            var o = document.getElementById(objectId);
            oTop = o.offsetTop;
            while (o.offsetParent != null) {
                oParent = o.offsetParent
                oTop += oParent.offsetTop  // Add parent top position
                o = oParent
            }
            return oTop
        }
    </script>
</head>
<body>
    @{
        CommonService.Model.CaseManager.B_Case bCase = ViewBag.Case;
        CommonService.Model.SysManager.C_Userinfo userinfo = ViewBag.userinfo;
        CommonService.Model.FlowManager.P_Business_flow businessFlow = ViewBag.businessFlow;
        CommonService.Model.CaseManager.B_Case_Confirm caseConfirm = ViewBag.caseConfirm;
        List<CommonService.Model.CaseManager.B_Case_Confirm> confirmList = ViewBag.confirmList;
        List<CommonService.Model.Customer.V_CheckAuthority> VCheckAuthoritys = ViewBag.VCheckAuthoritys;//案件稽查情况
        string fkCode = ViewBag.FkCode;
        int fkType = ViewBag.FkType;
        string targetUrl = String.Empty;//目标链接
        string entry_Statistics_Details = String.Empty;//进程情况
    }
    <div class="rightinfo">
        <div>
            <div class="fl rightcontent">
                <div class="right_top">
                    <div class="flow_nav">
                        @if (Model.Count() == 1)
                        {//只有一个业务流程的情况


                            <div class="fl flowNodeSpace">
                                @if (Model.FirstOrDefault().P_Business_state.Value == Convert.ToInt32(BusinessFlowStatus.未开始))
                                {
                                    <span class="fl grey_start start"></span><span class="fl grey_body cursor middle" businessflowcode="@Model.FirstOrDefault().P_Business_flow_code">@Model.FirstOrDefault().P_Business_flow_name</span><span class="fl grey_end end"></span>
                                }
                                else if (Model.FirstOrDefault().P_Business_state.Value == Convert.ToInt32(BusinessFlowStatus.正在进行))
                                {
                                    <span class="fl yellow_start start"></span><span class="fl yellow_body cursor middle" businessflowcode="@Model.FirstOrDefault().P_Business_flow_code">@Model.FirstOrDefault().P_Business_flow_name</span><span class="fl yellow_end end"></span>
                                }
                                else if (Model.FirstOrDefault().P_Business_state.Value == Convert.ToInt32(BusinessFlowStatus.已结束))
                                {
                                    <span class="fl blue_start start"></span><span class="fl blue_body cursor middle" businessflowcode="@Model.FirstOrDefault().P_Business_flow_code">@Model.FirstOrDefault().P_Business_flow_name</span><span class="fl blue_end end"></span>
                                }
                            </div>
                        }
                        else if (Model.Count() > 1)
                        {
                            int businessFlowNo = 0;
                            foreach (var item in Model)
                            {
                                businessFlowNo++;
                                <div class="fl flowNodeSpace">
                                    @if (businessFlowNo == 1)
                                    {//第一个业务流程节点
                                        if (item.P_Business_state.Value == Convert.ToInt32(BusinessFlowStatus.未开始))
                                        {
                                            <span class="fl grey_start start"></span><span class="fl grey_body cursor middle" businessflowcode="@item.P_Business_flow_code">@item.P_Business_flow_name</span>
                                            //业务流程节点结束(也是下一个流程节点开始)
                                            var NextBusinessFlows = from allList in Model
                                                                    where allList.P_Business_order > item.P_Business_order
                                                                    orderby allList.P_Business_order ascending
                                                                    select allList;
                                            if (NextBusinessFlows.FirstOrDefault().P_Business_state.Value == Convert.ToInt32(BusinessFlowStatus.未开始))
                                            {
                                                <span class="fl grey_end_grey_start end"></span>
                                            }
                                            else if (NextBusinessFlows.FirstOrDefault().P_Business_state.Value == Convert.ToInt32(BusinessFlowStatus.正在进行))
                                            {
                                                <span class="fl grey_end_yellow_start end"></span>
                                            }
                                            else if (NextBusinessFlows.FirstOrDefault().P_Business_state.Value == Convert.ToInt32(BusinessFlowStatus.已结束))
                                            {
                                                <span class="fl grey_end_blue_start end"></span>
                                            }
                                        }
                                        else if (item.P_Business_state.Value == Convert.ToInt32(BusinessFlowStatus.正在进行))
                                        {
                                            <span class="fl yellow_start start"></span><span class="fl yellow_body cursor middle" businessflowcode="@item.P_Business_flow_code">@item.P_Business_flow_name</span>
                                            //业务流程节点结束(也是下一个流程节点开始)
                                            var NextBusinessFlows = from allList in Model
                                                                    where allList.P_Business_order > item.P_Business_order
                                                                    orderby allList.P_Business_order ascending
                                                                    select allList;
                                            if (NextBusinessFlows.FirstOrDefault().P_Business_state.Value == Convert.ToInt32(BusinessFlowStatus.未开始))
                                            {
                                                <span class="fl yellow_end_grey_start end"></span>
                                            }
                                            else if (NextBusinessFlows.FirstOrDefault().P_Business_state.Value == Convert.ToInt32(BusinessFlowStatus.正在进行))
                                            {
                                                <span class="fl yellow_end_yellow_start end"></span>
                                            }
                                            else if (NextBusinessFlows.FirstOrDefault().P_Business_state.Value == Convert.ToInt32(BusinessFlowStatus.已结束))
                                            {
                                                <span class="fl yellow_end_blue_start end"></span>
                                            }
                                        }
                                        else if (item.P_Business_state.Value == Convert.ToInt32(BusinessFlowStatus.已结束))
                                        {
                                            <span class="fl blue_start start"></span><span class="fl blue_body cursor middle" businessflowcode="@item.P_Business_flow_code">@item.P_Business_flow_name</span>
                                            //业务流程节点结束(也是下一个流程节点开始)
                                            var NextBusinessFlows = from allList in Model
                                                                    where allList.P_Business_order > item.P_Business_order
                                                                    orderby allList.P_Business_order ascending
                                                                    select allList;
                                            if (NextBusinessFlows.FirstOrDefault().P_Business_state.Value == Convert.ToInt32(BusinessFlowStatus.未开始))
                                            {
                                                <span class="fl blue_end_grey_start end"></span>
                                            }
                                            else if (NextBusinessFlows.FirstOrDefault().P_Business_state.Value == Convert.ToInt32(BusinessFlowStatus.正在进行))
                                            {
                                                <span class="fl blue_end_yellow_start end"></span>
                                            }
                                            else if (NextBusinessFlows.FirstOrDefault().P_Business_state.Value == Convert.ToInt32(BusinessFlowStatus.已结束))
                                            {
                                                <span class="fl blue_end_blue_start end"></span>
                                            }
                                        }
                                    }
                                    else if (businessFlowNo == Model.Count())
                                    {//最后一个业务流程节点
                                        if (item.P_Business_state.Value == Convert.ToInt32(BusinessFlowStatus.未开始))
                                        {
                                            <span class="fl grey_body cursor middle" businessflowcode="@item.P_Business_flow_code">@item.P_Business_flow_name</span><span class="fl grey_end end"></span>
                                        }
                                        else if (item.P_Business_state.Value == Convert.ToInt32(BusinessFlowStatus.正在进行))
                                        {
                                            <span class="fl yellow_body cursor middle" businessflowcode="@item.P_Business_flow_code">@item.P_Business_flow_name</span><span class="fl yellow_end end"></span>
                                        }
                                        else if (item.P_Business_state.Value == Convert.ToInt32(BusinessFlowStatus.已结束))
                                        {
                                            <span class="fl blue_body cursor middle" businessflowcode="@item.P_Business_flow_code">@item.P_Business_flow_name</span><span class="fl blue_end end"></span>
                                        }
                                    }
                                    else
                                    {//中间流程节点
                                        if (item.P_Business_state.Value == Convert.ToInt32(BusinessFlowStatus.未开始))
                                        {
                                            <span class="fl grey_body cursor middle" businessflowcode="@item.P_Business_flow_code">@item.P_Business_flow_name</span>
                                            //业务流程节点结束(也是下一个流程节点开始)
                                            var NextBusinessFlows = from allList in Model
                                                                    where allList.P_Business_order > item.P_Business_order
                                                                    orderby allList.P_Business_order ascending
                                                                    select allList;
                                            if (NextBusinessFlows.FirstOrDefault().P_Business_state.Value == Convert.ToInt32(BusinessFlowStatus.未开始))
                                            {
                                                <span class="fl grey_end_grey_start end"></span>
                                            }
                                            else if (NextBusinessFlows.FirstOrDefault().P_Business_state.Value == Convert.ToInt32(BusinessFlowStatus.正在进行))
                                            {
                                                <span class="fl grey_end_yellow_start end"></span>
                                            }
                                            else if (NextBusinessFlows.FirstOrDefault().P_Business_state.Value == Convert.ToInt32(BusinessFlowStatus.已结束))
                                            {
                                                <span class="fl grey_end_blue_start end"></span>
                                            }

                                        }
                                        else if (item.P_Business_state.Value == Convert.ToInt32(BusinessFlowStatus.正在进行))
                                        {
                                            <span class="fl yellow_body cursor middle" businessflowcode="@item.P_Business_flow_code">@item.P_Business_flow_name</span>
                                            //业务流程节点结束(也是下一个流程节点开始)
                                            var NextBusinessFlows = from allList in Model
                                                                    where allList.P_Business_order > item.P_Business_order
                                                                    orderby allList.P_Business_order ascending
                                                                    select allList;
                                            if (NextBusinessFlows.FirstOrDefault().P_Business_state.Value == Convert.ToInt32(BusinessFlowStatus.未开始))
                                            {
                                                <span class="fl yellow_end_grey_start end"></span>
                                            }
                                            else if (NextBusinessFlows.FirstOrDefault().P_Business_state.Value == Convert.ToInt32(BusinessFlowStatus.正在进行))
                                            {
                                                <span class="fl yellow_end_yellow_start end"></span>
                                            }
                                            else if (NextBusinessFlows.FirstOrDefault().P_Business_state.Value == Convert.ToInt32(BusinessFlowStatus.已结束))
                                            {
                                                <span class="fl yellow_end_blue_start end"></span>
                                            }
                                        }
                                        else if (item.P_Business_state.Value == Convert.ToInt32(BusinessFlowStatus.已结束))
                                        {
                                            <span class="fl blue_body cursor middle" businessflowcode="@item.P_Business_flow_code">@item.P_Business_flow_name</span>
                                            //业务流程节点结束(也是下一个流程节点开始)
                                            var NextBusinessFlows = from allList in Model
                                                                    where allList.P_Business_order > item.P_Business_order
                                                                    orderby allList.P_Business_order ascending
                                                                    select allList;
                                            if (NextBusinessFlows.FirstOrDefault().P_Business_state.Value == Convert.ToInt32(BusinessFlowStatus.未开始))
                                            {
                                                <span class="fl blue_end_grey_start end"></span>
                                            }
                                            else if (NextBusinessFlows.FirstOrDefault().P_Business_state.Value == Convert.ToInt32(BusinessFlowStatus.正在进行))
                                            {
                                                <span class="fl blue_end_yellow_start end"></span>
                                            }
                                            else if (NextBusinessFlows.FirstOrDefault().P_Business_state.Value == Convert.ToInt32(BusinessFlowStatus.已结束))
                                            {
                                                <span class="fl blue_end_blue_start end"></span>
                                            }
                                        }
                                    }
                                </div>
                            }

                        }
                    </div>

                </div>
                <div class="right_bottom">
                    <iframe name="iframe_childreBusinessFlow" id="iframe_childreBusinessFlow" width="100%" height="100%" frameborder="0" baseurl="/flowmanager/businessflow/pkrelationbusinessflowlist?pkCode=@fkCode&businessFlowCode={sid_Iterm}&fkType=@fkType" src="/flowmanager/businessflow/pkrelationbusinessflowlist?pkCode=@fkCode&businessFlowCode=&fkType=@fkType&fstate=@ViewBag.Fstate" scrolling="auto"></iframe>
                </div>
            </div>
            
            <div class="fl leftcontent">
                @*<div class="tabletitle"><a id="info" class="righttitle" href="#" onclick="caseInfo()">基本信息</a><a id="dynamic" href="#" onclick="caseDynamic()" style="margin-left:30%;">案件动态</a></div>*@
                <div class="itab">
                    <ul>
                        <li><a id="info" href="#" onclick="caseInfo()" class="selected">基本信息</a></li>
                        <li><a id="dynamic" href="#" onclick="caseDynamic()" class="">案件动态</a></li>@*<span class="dynamicMark">新</span>*@
                    </ul>
                </div>
                <table id="caseInfo" class="case_info_table" width="340px">
                    <tr>
                        <td class="textindent leftContentPaddingLeft">案&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;号：</td>
                        <td class="textindent"><a target="popdialog_owndefine" title="案件信息" dialogwidth="1300" dialogheight="780" href="/casemanager/case/tabdetails?caseCode=@bCase.B_Case_code">@bCase.B_Case_number</a></td>
                    </tr>
                    <tr>
                        <td width="25%" class="textindent leftContentPaddingLeft">客&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;户：</td>
                        @{
                            string[] CustomerNames = bCase.C_Customer_name.Split(',');
                            string[] CustomerCodes = bCase.C_Customer_code.Split(',');
                            int client2 = 0;
                        }
                        <td width="75%" class="textindent">
                            @foreach (var clientName in CustomerNames)
                            {
                                string Comma = ",";
                                if (client2 == CustomerNames.Length - 1)
                                {
                                    Comma = "";
                                }
                                <a target="popdialog_owndefine" title="客户信息" dialogwidth="1240" dialogheight="700" href="/basedata/customer/tabdetails?customerCode=@CustomerCodes[client2]">@clientName</a>@Comma
                                client2++;
                            }
                        </td>
                    </tr>
                    <tr>
                        <td width="25%" class="textindent leftContentPaddingLeft">委&nbsp;托&nbsp;&nbsp;人：</td>
                        @{
                            string[] clientNames = bCase.C_Client_name.Split(',');
                            string[] clientCodes = bCase.C_Client_code.Split(',');
                            int client = 0;
                        }
                        <td width="75%" class="textindent">
                            @foreach (var clientName in clientNames)
                            {
                                string Comma = ",";
                                if (client == clientCodes.Length - 1)
                                {
                                    Comma = "";
                                }
                                <a target="popdialog_owndefine" title="委托人信息" dialogwidth="1240" dialogheight="700" href="/basedata/customer/tabdetails?customerCode=@clientCodes[client]">@clientName</a>@Comma
                                client++;
                            }
                        </td>
                    </tr>
                    <tr>
                        <td align="right" class="textindent leftContentPaddingLeft">对方当事人：</td>
                        @{
                            string[] personNames = bCase.C_Person_name.Split(',');
                            string[] personCodes = bCase.C_Person_code.Split(',');
                            string[] personTypes = bCase.C_Person_type.Split(',');
                            int person = 0;
                        }
                        <td class="textindent">
                            @foreach (var personType in personTypes)
                            {
                                string Comma = ",";
                                if (person == personCodes.Length - 1)
                                {
                                    Comma = "";
                                }
                                if (personType == Convert.ToInt32(CaselinkEnum.对方当事人个人).ToString())
                                {
                                    <a target="popdialog_owndefine" title="对方当事人详细" dialogwidth="1080" dialogheight="580" href="/basedata/PRival/TabDetails?prival_code=@personCodes[person]">@personNames[person]</a>@Comma
                                }
                                else if (personType == Convert.ToInt32(CaselinkEnum.对方当事人公司).ToString())
                                {
                                    <a target="popdialog_owndefine" title="对方当事人详细" dialogwidth="1080" dialogheight="580" href="/basedata/crival/TabDetails?crival_code=@personCodes[person]">@personNames[person]</a>@Comma
                                }
                                person++;
                            }
                        </td>
                    </tr>
                    <tr>
                        <td align="right" class="textindent leftContentPaddingLeft">工程名称：</td>
                        @{
                            string[] projectNames = bCase.C_Project_name.Split(',');
                            string[] projectCodes = bCase.C_Project_code.Split(',');
                            int project = 0;
                        }
                        <td class="textindent">
                            @foreach (var projectName in projectNames)
                            {
                                string Comma = ",";
                                if (project == projectCodes.Length - 1)
                                {
                                    Comma = "";
                                }
                                <a target="popdialog_owndefine" title="委托人信息" dialogwidth="1240" dialogheight="700" href="/basedata/Involved_project/CutTabDetails?Involved_project_code=@projectCodes[project]">@projectName</a>@Comma
                                project++;
                            }
                        </td>
                    </tr>
                    @*<tr style="visibility:hidden;">
                    <td align="right">被执行人：</td>
                    @{
                       string[] executerTypes = bCase.C_Executer_type.Split(',');
                       string[] executerCodes = bCase.C_Executer_code.Split(',');
                       string[] executerNames = bCase.C_Executer_name.Split(',');
                       int executer = 0;
                    }
                    <td class="textindent">
                        @foreach (var executerType in executerTypes)
                       {
                           string Comma = ",";
                           if (executer == executerCodes.Length - 1)
                           {
                               Comma = "";
                           }
                           if (executerType == Convert.ToInt32(CaselinkEnum.被执行人个人).ToString())
                           {
                    <a target="popdialog_owndefine" title="被执行人详细" dialogwidth="1080" dialogheight="580" href="/basedata/PRival/TabDetails?prival_code=@executerCodes[executer]">@executerNames[executer]</a>@Comma
                           }
                           else if (executerType == Convert.ToInt32(CaselinkEnum.被执行人公司).ToString())
                           {
                    <a target="popdialog_owndefine" title="被执行人详细" dialogwidth="1080" dialogheight="580" href="/basedata/crival/TabDetails?crival_code=@executerCodes[executer]">@executerNames[executer]</a>@Comma
                           }
                           executer++;
                       }
                    </td>
                </tr>*@

                    <tr>
                        <td class="textindent leftContentPaddingLeft">案件类型：</td>
                        <td class="textindent">@bCase.B_Case_type_name</td>
                    </tr>
                    <tr>
                        <td class="textindent leftContentPaddingLeft">移交时间：</td>
                        <td class="textindent">@(bCase.B_Case_registerTime == null ? "" : bCase.B_Case_registerTime.Value.ToString("yyyy年MM月dd日"))</td>
                    </tr>
                    <tr>
                        <td class="textindent leftContentPaddingLeft">首席审核时间：</td>
                        <td class="textindent">@(bCase.B_Case_sureDate == null ? "" : bCase.B_Case_sureDate.Value.ToString("yyyy年MM月dd日"))</td>
                    </tr>
                    <tr>
                        <td class="textindent leftContentPaddingLeft">移交标的：</td>
                        <td class="textindent">@bCase.B_Case_transferTargetMoney  (元)</td>
                    </tr>
                    <tr>
                        <td class="textindent leftContentPaddingLeft">部门人员：</td>
                        <td class="textindent"><a id="bumen" href="##" onclick="showDeptPerson('tabDetails_3', 1)">查看详情</a></td>
                    </tr>
                    <tr>
                        <td class="textindent leftContentPaddingLeft">专业顾问：</td>
                        <td class="textindent">@bCase.B_Case_consultant_name </td>
                    </tr>
                    <tr>
                        <td class="textindent leftContentPaddingLeft">法院信息：</td>
                        <td class="textindent"><a id="fanyuan" href="##" onclick="showfy('tabDetails', 1)">查看详情</a> </td>
                    </tr>
                    <tr>
                        <td class="textindent leftContentPaddingLeft">执行律师：</td>
                        <td class="textindent"><a id="lvshi" href="##" onclick="showfy_2('tabDetails_2', 1)">查看详情</a> </td>
                    </tr>
                    <tr>
                        <td class="textindent leftContentPaddingLeft">预期收益：</td>
                        <td class="textindent">@ViewBag.expectedGrant (元)</td>
                    </tr>
                    <tr>
                        <td class="textindent leftContentPaddingLeft">文书收入：</td>
                        <td class="textindent">@ViewBag.DocumValue (元)</td>
                    </tr>
                    @*<tr>
                    <td align="right">文书收入时间：</td>
                    <td class="textindent">@ViewBag.DocumTimeValue</td>
                </tr>*@
                    <tr>
                        <td class="textindent leftContentPaddingLeft">逾期收入：</td>
                        <td class="textindent">@ViewBag.yqsrValue (元)</td>
                    </tr>
                    @*<tr class="nobottomborder">
                    <td align="right">逾期收入时间：</td>
                    <td class="textindent">@ViewBag.yqsrTimeValue</td>
                </tr>*@
                    <tr>
                        <td></td>
                        <td style="text-align:right;"><a id="jajy" href="##" onclick="showjajy('tabDetails_4', 1)">查看结案纪要</a></td>
                    </tr>
                </table>
                <div id="caseDynamic" style="display: none;width:340px; border: dotted 1px #c7c7c7;">
                    <div style="background-color: #E2EFF8; border-radius: 5px; line-height: 24px; font-weight: bold; text-indent: 10px; border: solid 1px #AED0EA;margin-top:5px; ">
                        稽查情况
                    </div>
                    <table id="casejaqk" class="casejaqk">
                        <tbody>
                            @foreach (var item in VCheckAuthoritys)
                            {
                                if (item.AuthorityType == 1)
                                {//一审稽查
                                    targetUrl = "/Milepost/Milepost/MilepostList?J_Milepost_Type=1&pkCode=" + fkCode;
                                }
                                else if (item.AuthorityType == 2)
                                {//二审稽查
                                    targetUrl = "/Milepost/Milepost/MilepostList?J_Milepost_Type=2&pkCode=" + fkCode;
                                }
                                else if (item.AuthorityType == 3)
                                {//执行里程碑
                                    targetUrl = "/Milepost/Milepost/MilepostList?J_Milepost_Type=3&pkCode=" + fkCode;
                                }
                                else if (item.AuthorityType == 4)
                                {//非里程碑
                                    targetUrl = "/Milepost/NoMilepost/List?pkCode=" + fkCode;
                                }
                                <tr target="sid_Iterm" rel="">
                                    <td>@item.AuthorityName</td>
                                    @if (item.AuthorityTime == 0)
                                    {
                                        <td>0次</td>
                                    }
                                    else
                                    {
                                        <td><a href="@targetUrl" target="_blank" title="点击查看" style="color: #056dae; text-decoration: underline;">@item.AuthorityTime 次</a></td>
                                    }
                                </tr>
                            }
                        </tbody>
                    </table>
                    <div style="background-color: #E2EFF8; border-radius: 5px; line-height: 24px; font-weight: bold; text-indent: 10px; border: solid 1px #AED0EA;margin-top:5px; ">
                        进程情况
                    </div>
                    <div style="line-height: 15px; padding-top: 10px;margin-bottom:10px; ">
                        @{
                            if (bCase.B_Case_Delay_Entry_Statistics_Count > 0)
                            {
                                entry_Statistics_Details += "<span style=color:blue;>有延期</span> ";
                            }
                            if (bCase.B_Case_HandlingState_Entry_Statistics_Count > 0 && bCase.B_Case_WarningSituation_Entry_Statistics_Count > 0)
                            {
                                entry_Statistics_Details += "<span style=color:red;>已超时</span>";
                            }
                            else if (bCase.B_Case_HandlingState_Entry_Statistics_Count > 0 && bCase.B_Case_WarningSituation_Entry_Statistics_Count <= 0)
                            {
                                entry_Statistics_Details += "<span style=color:red;>已超时</span>";
                            }
                            else if (bCase.B_Case_HandlingState_Entry_Statistics_Count <= 0 && bCase.B_Case_WarningSituation_Entry_Statistics_Count > 0)
                            {
                                entry_Statistics_Details += "<span style=color:orange;>预警</span>";
                            }
                        }
                        <a title="进程情况" id="entryChange_@bCase.B_Case_id" onmouseout="omout_entryChange()" onclick="omover_entryChange('entryChange_@bCase.B_Case_id', 'entityChangeDetails','/MonitorManager/Entry_Change/EntryChangeRecord?pkCode=@bCase.B_Case_code')" style="text-indent: 10px;">@Html.Raw(entry_Statistics_Details)</a>
                    </div>
                </div>
            </div>
            
            @if (businessFlow != null)
            {
                <div class="fr margin_left8" style="margin-left:60%;float:left;">
                    <a style=" padding-left:10px;padding-right:10px;" class="endcase" target="popdialog_owndefine" title="提交结案" dialogwidth="900" dialogheight="510" href="/CaseManager/EndCase/Create?fkCode=@fkCode&businessFlowCode=@businessFlow.P_Business_flow_code">提交结案</a>
                </div>
            }
            @if (caseConfirm != null)
            {
                <div class="fr margin_left8" style="margin-left:60%;float:left;">
                    <a style=" padding-left:10px;padding-right:10px;" class="endcase" target="popdialog_owndefine" title="结案确认" dialogwidth="900" dialogheight="700" href="/CaseManager/EndCase/ConfirmCase?B_Case_Confirm_Code=@caseConfirm.B_Case_Confirm_code">结案确认</a>
                </div>
            }
            <div class="clear"></div>
        </div>
    </div>

    <div id="tabDetails" class="flowDetails">


        <table class="case_info_table" width="100%">
            <tr style="height:30px;">
                <td width="100px">一审管辖法院：</td>
                <td align="left"><a href="##" onclick="opewh_1('/basedata/court/TabDetails?courtCode=@ViewBag.Cout1')">@ViewBag.CoutName1</a></td>
            </tr>
            <tr style="height:30px;">
                <td width="100px">二审管辖法院：</td>
                <td align="left"><a href="##" onclick="opewh_1('/basedata/court/TabDetails?courtCode=@ViewBag.Cout2')">@ViewBag.CoutName2</a></td>
            </tr>
            <tr style="height:30px;">
                <td width="100px">执行法院：</td>
                <td align="left"><a href="##" onclick="opewh_1('/basedata/court/TabDetails?courtCode=@ViewBag.Cout3')">@ViewBag.CoutName3</a></td>
            </tr>
            <tr style="height:30px;">
                <td width="100px">审判监督法院：</td>
                <td align="left"><a href="##" onclick="opewh_1('/basedata/court/TabDetails?courtCode=@ViewBag.Cout4')">@ViewBag.CoutName4</a></td>
            </tr>




        </table>
    </div>

    <div id="tabDetails_2" class="flowDetails_2">
        @*<div style="float:right;cursor:pointer;" onclick=" showfy_2('tabDetails_2', 0)"><img src="/Theme/images/close1.png" /></div>*@
        <table class="case_info_table" width="100%">

            <tr style="height:20px;">
                <td width="100px;" align="center" style="font-weight:bold;">任务类型</td>
                <td align="center" style="font-weight:bold;">执行律师</td>
                <td width="100px;" align="center" style="font-weight:bold;">部门</td>

            </tr>
            @foreach (var item in Model)
            {
                <tr style="height:20px;">
                    <td align="center">@item.P_Business_flow_name</td>
                    <td align="center">@item.P_Business_person_name</td>
                    <td align="center">@item.P_Business_personDepName</td>
                </tr>
            }

        </table>
    </div>

    <div id="tabDetails_3" class="flowDetails">
        <table class="case_info_table" width="100%">
            <tr style="height:30px;">
                <td width="100px">组织机构：</td>
                <td align="left">@userinfo.C_Userinfo_Organization_name-@userinfo.C_Userinfo_post_name</td>
            </tr>
            <tr style="height:30px;">
                <td width="100px">首席专家：</td>
                <td align="left">@bCase.C_Case_firstClassResponsiblePersonName</td>
            </tr>
            <tr style="height:30px;">
                <td width="100px">专家部长：</td>
                <td align="left">@bCase.B_Case_personName</td>
            </tr>
        </table>
    </div>

    <div id="tabDetails_4" class="flowDetails_2">
        <table class="case_info_table" width="100%">
            <tr style="height:20px;">
                <td width="100px;" align="center" style="font-weight:bold;">业务流程</td>
                <td align="center" style="font-weight:bold;">审核状态</td>
                <td align="center" style="font-weight:bold;">提交人</td>
                <td width="100px;" align="center" style="font-weight:bold;">操作</td>
            </tr>
            @if (confirmList != null)
            {
                foreach (var item in confirmList)
                {
                    <tr style="height:20px;">
                        <td align="center">@item.P_Business_Flow_name</td>
                        <td align="center">@item.B_Case_Confirm_checkStateName</td>
                        <td align="center">@item.B_Case_Confirm_creator_name</td>
                        <td align="center"><a href="##" onclick="jajyDetails('/CaseManager/EndCase/ConfirmCase?B_Case_Confirm_Code=@item.B_Case_Confirm_code')">详情</a></td>
                    </tr>
                }
            }

        </table>
    </div>

    <!--进程条目变更信息容器-->
    <div id="entityChangeDetails" trlabid="" trid="" trclient_url="" onmouseout="omout_Tj(this)" onmouseover="omover2(this)" class="tjjyDetails" style="overflow: auto; border: 1px solid #000000; display:none; background-color:white; height:180px;">
        <table border="1" cellpadding="5" cellspacing="5" style=" margin-left: 10px; width: 900px;">
            <tr style="height: 180px; width: 900px;">
                <td align="center" width="900px">
                    <img src="/Theme/assets/global/plugins/slider-revolution-slider/rs-plugin/assets/loader2.gif" /> 加载中...
                </td>
            </tr>
        </table>
    </div>
</body>
</html>
