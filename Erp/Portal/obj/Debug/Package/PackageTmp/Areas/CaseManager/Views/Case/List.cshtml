@using CommonService.Model.CaseManager;
@using CommonService.Common;
@using CommonService.Model.SysManager;
@using Context;
@model IEnumerable<CommonService.Model.CaseManager.B_Case>
@{
    Layout = "~/Views/Shared/_ListSearchWithDialogTemplate.cshtml";//带表单查询的列表页面固定模板
}
@{
    ViewBag.Title = "案件列表";
}
@{
    B_Case caseConditon = ViewBag.CaseConditon;//案件条件模型
    int caseType = ViewBag.caseType;
    int lawyerType = ViewBag.LawyerType;//律师类型
    Guid? orgCode = ViewBag.OrgCode;//所属部门Guid(允许为NULL)
    Guid? postCode = ViewBag.PostCode;//所属岗位Guid(允许为NULL)
    Guid? postGroupCode = ViewBag.PostGroupCode;//所属岗位组Guid(允许为NULL)
}
@section HeadScript{
    <script type="text/javascript">
        $(function () {
            if (getCookie("isShow") == "0") {
                $(".downDiv").attr("class", "upDiv");
                $(".seachdiv2").show();
                $("#hidOrShow").html("收起");
            } else {
                $(".upDiv").attr("class", "downDiv");
                $(".seachdiv2").hide();
                $("#hidOrShow").html("高级查询");
            }

            $("a[target=popdialog_owndefine]").each(function () {
                $(this).click(function (event) {
                    event.preventDefault();
                    var $this = $(this);
                    //替换url参数
                    var switchUrl = $this.attr("href");
                    _openDialog($(this).attr("title"), switchUrl, $(this).attr("dialogwidth"), $(this).attr("dialogheight"));
                });
            });

            $("a[target=popdialog_Transformation]").each(function () {
                $(this).click(function (event) {
                    event.preventDefault();
                    var $this = $(this);
                    var caseCode = commonListData.uniqueId;
                    if ($this.attr('edit')) {
                        if (caseCode == '') {
                            alertMsg.warn("请选择信息！");
                            return;
                        }
                    }
                    $.ajax({
                        type: 'post',
                        url: '/CaseManager/case/IsNotAudited?caseCode=' + caseCode,
                        data: null,
                        dataType: "json",
                        cache: true,
                        success: function (data) {
                            if(data=='True')
                            {
                                alertMsg.warn("已经有提交的转化，请耐心等待<br>审核后再操作！");
                            }else
                            {
                                //替换url参数
                                var switchUrl = $this.attr("href").replace("{sid_Iterm}", caseCode);
                                _openDialog($this.attr("title"), switchUrl, $this.attr("dialogwidth"), $this.attr("dialogheight"));
                            }
                        },
                        error: function () {
                            alert('网络错误，请稍后再试!');
                        }
                    });                    
                });
            });
        })
        function Layer_HideOrShow() {
            if ($("#hidOrShow").html() == "高级查询") {
                $(".downDiv").attr("class", "upDiv");
                $(".seachdiv2").show();
                $("#hidOrShow").html("收起");
                document.cookie = "isShow=0";
            }
            else {
                $(".upDiv").attr("class", "downDiv");
                $(".seachdiv2").hide();
                $("#hidOrShow").html("高级查询");
                document.cookie = "isShow=1";
            }
        }

        //读取cookies
        function getCookie(name) {
            var arr, reg = new RegExp("(^| )" + name + "=([^;]*)(;|$)");

            if (arr = document.cookie.match(reg))

                return unescape(arr[2]);
            else
                return null;
        }

        function openCaseExecuteView(buttonPower, title, dialogwidth, dialogheight, switchUrl, isPreSetManager, roleButtonIds) {//双击打开详细页面
            var isAllowOpen = false;//是否允许打开
            if (isPreSetManager == '1') {
                isAllowOpen = true;
            } else {
                if (roleButtonIds.indexOf(buttonPower) >= 0) {
                    isAllowOpen = true;
                }
            }
            if (isAllowOpen) {
                _openDialog(title, switchUrl, dialogwidth, dialogheight);
            }
        }
        function osb(val) {
            document.getElementById("@ViewBag.SearchFormID").action = val;
            document.getElementById("@ViewBag.SearchFormID").submit();

        }
    </script>
}@section HeadCss{
    <style type="text/css">
        .aaa:link {
            color: blue;
        }

        .aaa:hover {
            color: blue;
        }

        .aaa:visited {
            color: blue;
         
        }
        .aaa{cursor:pointer;}
        .upDiv {
            float: left;
            margin-left: 5px;
            width: 30px;
            height: 30px;
            
        }
        .downDiv {
            float: left;
            margin-left: 5px;
            width: 30px;
            height: 30px;
           
        }
        .toolbar li.lawBtn {
            background: #F4A22E;
            border:0px;            
        }
        .toolbar li.lawBtn a{color:#fff;}
    </style>
}
@{
    List<CommonService.Model.C_Parameters> Casetype = ViewBag.Case_type;
    List<CommonService.Model.C_Parameters> Casenature = ViewBag.Case_nature;
    List<CommonService.Model.C_Parameters> CasecustomerType = ViewBag.Case_customerType;
    List<CommonService.Model.C_Parameters> Case_state = ViewBag.Case_state;
    List<CommonService.Model.C_Parameters> Casesta = ViewBag.casesta;
    List<CommonService.Model.C_Parameters> CaseLevel = ViewBag.CaseLevel;
    List<CommonService.Model.FlowManager.P_Flow> casestage = ViewBag.casestage;
    List<CommonService.Model.C_Region> RegionLists = ViewBag.RegionList;
    List<C_Role_button> RoleButtons = ViewBag.RoleButtons;//按钮权限
}
<li class="tools" >
    <ul class="toolbar" style="margin-bottom:8px">
        @if (UIContext.Current.IsPreSetManager)
        {
            if (caseType == 2 || caseType == 3 || caseType == 4)
            {//只有在"我的未开始"、"我的在办"、"我的已结"案件列表中显示
               <li class="lawBtn"><a onclick="setLawyerType(1)" href="javascript:void(0);"><span></span>担任主办</a></li>
               <li class="lawBtn"><a onclick="setLawyerType(2)" href="javascript:void(0);"><span></span>担任协办</a></li>
            }
            <li><a target="popdialog" title="添加案件" dialogwidth="1240" dialogheight="650" href="/CaseManager/case/create"><span><img src="/theme/images/new_add.png" /></span>添加</a></li>
            <li><a target="popdialog" title="修改案件" dialogwidth="1400" dialogheight="650" edit="edit" href="/CaseManager/case/CaseTabDetails?caseCode={sid_Iterm}&type=1"><span><img src="/theme/images/new_edit.png" /></span>修改</a></li>
            <li><a target="ajaxtodo" title="确认要删除选中数据吗?" singleoperate="singleoperate" href="/CaseManager/case/delete?B_Case_code={sid_Iterm}"><span><img src="/theme/images/new_delete.png" /></span>删除</a></li>
            <li><a target="popdialog" title="案件详细" dialogwidth="1300" dialogheight="720" edit="edit" href="/casemanager/case/tabdetails?caseCode={sid_Iterm}"><span><img src="/theme/images/new_view.png" /></span>详细</a></li>
            <li><a target="popdialog" title="案件计划" dialogwidth="1400" dialogheight="870" edit="edit" href="/casemanager/caseplan/tabdetails?fkCode={sid_Iterm}"><span><img src="/theme/images/new_plan.png" /></span>案件计划</a></li>
            <li><a target="ajaxtodo" title="确认要启动案件吗" singleoperate="singleoperate" href="/casemanager/case/StartCase?caseCode={sid_Iterm}"><span><img src="/theme/images/new_start.png" /></span>启动案件</a></li>
            <li><a target="popdialog" title="案件执行" dialogwidth="1400" dialogheight="860" edit="edit" href="/casemanager/caseexecute/defaultlayout?fkCode={sid_Iterm}&fkType=@Convert.ToInt32(FlowTypeEnum.案件)"><span><img src="/theme/images/new_excute.png" /></span>案件执行</a></li>
            <li><a target="popdialog" title="案件转移" dialogwidth="1240" dialogheight="700" href="/casemanager/case/CaseTransfer"><span></span>案件转移</a></li>
            <li><a target="popdialog_Transformation" title="案件转化" dialogwidth="1100" dialogheight="800" edit="edit" href="/casemanager/case/CaseTransformation?caseCode={sid_Iterm}&type=1"><span></span>案件转化</a></li>           
            <li><a target="_self" title="导出" dialogwidth="1400" dialogheight="830" href="#" onclick="osb('/casemanager/case/Export')"><span><img src="/theme/images/new_export.png" /></span>导出</a></li>
            @*<li><a target="_self" id="doc_m" title="生成文书" href="#" ><span></span>生效文书</a></li>*@

            <script>
                function setck(val) {
                    $("#doc_m").attr("href", "/casemanager/case/ExeWrite?caseCode=" + $(val).attr("rel"));
                }

                function hq(title, dialogwidth, dialogheight, switchUrl, isPreSetManager) {
                    var isAllowOpen = false;//是否允许打开
                    if (isPreSetManager == '1') {
                        isAllowOpen = true;
                    } else {
                        if (roleButtonIds.indexOf(buttonPower) >= 0) {
                            isAllowOpen = true;
                        }
                    }
                    if (isAllowOpen) {
                        _openDialog(title, switchUrl, dialogwidth, dialogheight);
                    }

                }
            </script>
        }
        else
        {
            if (caseType == 2 || caseType == 3 || caseType == 4)
            {//只有在"我的未开始"、"我的在办"、"我的已结"案件列表中显示
               if (RoleButtons.Where(r => r.C_Menu_buttons_id == 1164).Count() != 0)
               {
                   <li class="lawBtn"><a onclick="setLawyerType(1)" href="javascript:void(0);"><span></span>担任主办</a></li>
               }
               if (RoleButtons.Where(r => r.C_Menu_buttons_id == 1165).Count() != 0)
               {
                   <li class="lawBtn"><a onclick="setLawyerType(2)" href="javascript:void(0);"><span></span>担任协办</a></li>
               }              
            }
            if (RoleButtons.Where(r => r.C_Menu_buttons_id == 74).Count() != 0)
            {
                <li><a target="popdialog" title="案件信息" dialogwidth="1240" dialogheight="650" href="/CaseManager/case/create"><span><img src="/theme/images/new_add.png" /></span>添加</a></li>
            }
            if (RoleButtons.Where(r => r.C_Menu_buttons_id == 75).Count() != 0)
            {
                <li><a target="popdialog" title="案件信息" dialogwidth="1400" dialogheight="650" edit="edit" href="/CaseManager/case/CaseTabDetails?caseCode={sid_Iterm}&type=1"><span><img src="/theme/images/new_edit.png" /></span>修改</a></li>
            }
            if (RoleButtons.Where(r => r.C_Menu_buttons_id == 76).Count() != 0)
            {
                <li><a target="ajaxtodo" title="确认要删除选中数据吗?" singleoperate="singleoperate" href="/CaseManager/case/delete?B_Case_code={sid_Iterm}"><span><img src="/theme/images/new_delete.png" /></span>删除</a></li>
            }
            if (RoleButtons.Where(r => r.C_Menu_buttons_id == 77).Count() != 0)
            {
                <li><a target="popdialog" title="案件详细" dialogwidth="1300" dialogheight="720" edit="edit" href="/casemanager/case/tabdetails?caseCode={sid_Iterm}"><span><img src="/theme/images/new_view.png" /></span>详细</a></li>
            }
            if (RoleButtons.Where(r => r.C_Menu_buttons_id == 80).Count() != 0)
            {
                <li><a target="popdialog" title="案件计划" dialogwidth="1400" dialogheight="870" edit="edit" href="/casemanager/caseplan/tabdetails?fkCode={sid_Iterm}&orgCode=@orgCode&postCode=@postCode"><span><img src="/theme/images/new_plan.png" /></span>案件计划</a></li>
            }
            if (RoleButtons.Where(r => r.C_Menu_buttons_id == 81).Count() != 0)
            {
                <li><a target="ajaxtodo" title="确认要启动案件吗" singleoperate="singleoperate" href="/casemanager/case/StartCase?caseCode={sid_Iterm}"><span><img src="/theme/images/new_start.png" /></span>启动案件</a></li>
            }
            if (RoleButtons.Where(r => r.C_Menu_buttons_id == 82).Count() != 0)
            {
                <li><a target="popdialog" title="案件执行" dialogwidth="1400" dialogheight="860" edit="edit" href="/casemanager/caseexecute/defaultlayout?fkCode={sid_Iterm}&fkType=@Convert.ToInt32(FlowTypeEnum.案件)"><span><img src="/theme/images/new_excute.png" /></span>案件执行</a></li>
            }
            if (RoleButtons.Where(r => r.C_Menu_buttons_id == 1166).Count() != 0)
            {
                <li><a target="popdialog" title="案件转移" dialogwidth="1240" dialogheight="700" href="/casemanager/case/CaseTransfer"><span></span>案件转移</a></li>
            }
            if (RoleButtons.Where(r => r.C_Menu_buttons_id == 1167).Count() != 0)
            {
                <li><a target="popdialog_Transformation" title="案件转化" dialogwidth="1100" dialogheight="800" edit="edit" href="/casemanager/case/CaseTransformation?caseCode={sid_Iterm}&type=1"><span></span>案件转化</a></li>
            }
            if (RoleButtons.Where(r => r.C_Menu_buttons_id == 1128).Count() != 0)
            {
                <li><a target="_self" title="导出" dialogwidth="1400" dialogheight="830" href="#" onclick="osb('/casemanager/case/Export')"><span><img src="/theme/images/new_export.png" /></span>导出</a></li>
            }
        }
    </ul>

    @using (Html.BeginForm("List", "Case", FormMethod.Post, new { id = ViewBag.SearchFormID, onsubmit = "return clickSearch(this);" }))
    {
        <ul class="seachform emptyforminfo">
            <input name="ThisPageIndex" class="ThisPageIndex" type="hidden" value="@ViewBag.ThisPageIndex" />
            <input name="IsExcutedFormSearch" class="IsExcutedFormSearch" type="hidden" value="@ViewBag.IsExcutedFormSearch" />
            @Html.Hidden("orgCode", orgCode)
            @Html.Hidden("postCode", postCode)
            @Html.Hidden("postGroupCode", postGroupCode)
            @Html.Hidden("caseType", caseType)
            @Html.Hidden("lawyerType", lawyerType)
            <li><label>案件编码</label>@Html.TextBox("B_Case_number", caseConditon.B_Case_number, new { @class = "scinput" })</li>
            <li><label>原告/被告</label>@Html.TextBox("B_Case_name", caseConditon.B_Case_name, new { @class = "scinput" })</li>
            <li><label>客户</label>@Html.Hidden("customerlookup.Code", caseConditon.C_Customer_code, new { lookupgroup = "customerlookup" })@Html.TextBox("customerlookup.Name", caseConditon.C_Customer_name, new { maxlength = "200", @readonly = "readonly", selectdialog = "selectdialog", @class = "textselect", title = "单选客户", switchurl = "/baseData/customer/singlecallbackreflist", dialogwidth = "1080", dialogheight = "620", lookupgroup = "customerlookup" })<i></i></li>
            <li><label>&nbsp;</label><input type="submit" class="scbtn" value="查询" onclick="osbselect('/casemanager/case/List')" /></li>
            <li onclick="Layer_HideOrShow()">
                <label id="hidOrShow" style="float:left;margin-left:20px;margin-top:5px;font-size:14px;color:blue;">高级查询</label><div class="upDiv"></div>
            </li>
        </ul>

        <ul class="emptyforminfo">
            <div class="seachdiv2" style="border-top: 3px solid #3596d7;margin-top:5px;float:left;">
                <div class="mulitytext">
                    <label>案件级别</label>
                    @{
                        IList<SelectListItem> CaseLevelItems = new List<SelectListItem>();
                        SelectListItem selectItemone = new SelectListItem();
                        selectItemone.Value = null;
                        selectItemone.Text = "全部";
                        CaseLevelItems.Add(selectItemone);
                        SelectListItem selectItemone1 = new SelectListItem();
                        selectItemone1.Value = "1";
                        selectItemone1.Text = "正常";
                        if (caseConditon.B_Case_isNotAudited != null)
                        {
                            if (caseConditon.B_Case_isNotAudited.Value.ToString() == selectItemone1.Value)
                            {
                                selectItemone1.Selected = true;
                            }
                        }
                        CaseLevelItems.Add(selectItemone1);
                        foreach (var item in CaseLevel)
                        {
                            SelectListItem selectItem = new SelectListItem();
                            selectItem.Value = item.C_Parameters_id.ToString();
                            selectItem.Text = item.C_Parameters_name+"案";
                            if (caseConditon.B_Case_isNotAudited != null)
                            {
                                if (caseConditon.B_Case_isNotAudited.Value == item.C_Parameters_id)
                                {
                                    selectItem.Selected = true;
                                }
                            }
                            CaseLevelItems.Add(selectItem);
                        }
                    }
                    @Html.DropDownList("B_Case_Level", CaseLevelItems)<i></i>
                </div>
                <div class="mulitytext"><label>对方当事人</label>@Html.Hidden("rivallookupParty.Code", caseConditon.B_Case_Rival_code, new { lookupgroup = "rivallookupParty" })@Html.Hidden("rivallookupParty.Type", caseConditon.C_Person_type, new { lookupgroup = "rivallookupParty" })@Html.TextBox("rivallookupParty.Name", caseConditon.B_Case_Rival_name, new { maxlength = "200", @readonly = "readonly", selectdialog = "selectdialog", @class = "textselect", title = "选择当事人", requiredInput = "请选择当事人名称", switchurl = "/baseData/rival/SingleListTabDetails?type=1&checkedRivalCode=", dialogwidth = "1080", dialogheight = "550", lookupgroup = "rivallookupParty" })<i></i></div>
                <div class="mulitytext"><label>主办律师</label>@Html.Hidden("mainLawyerlookup.Code", caseConditon.B_Case_lawyerCode, new { lookupgroup = "mainLawyerlookup" })@Html.TextBox("mainLawyerlookup.Name", caseConditon.B_Case_lawyerName, new { maxlength = "50", @readonly = "readonly", selectdialog = "selectdialog", @class = "textselect", title = "主办律师", switchurl = "/sysmanager/userinfo/singlecallbackref_orgpostuserlayout?otype=1", dialogwidth = "1050", dialogheight = "600", lookupgroup = "mainLawyerlookup" })<i></i></div>
                <div class="mulitytext"><label>收案年份</label>@Html.TextBox("B_Case_registerTime", caseConditon.B_Case_registerTime, new { date = "date", maxlength = "20", @readonly = "readonly", dateformat = "yyyy-MM-dd HH:mm:ss" })<i></i></div>
                <div class="mulitytext"><label>至</label>@Html.TextBox("B_Case_regiendTime", caseConditon.B_Case_registerTime2, new { date = "date", maxlength = "20", @readonly = "readonly", dateformat = "yyyy-MM-dd HH:mm:ss" })<i></i></div>
                <div class="mulitytext"><label>专业顾问</label>@Html.Hidden("consultantlookup.Code", caseConditon.B_Consultant_code, new { lookupgroup = "consultantlookup" })@Html.TextBox("consultantlookup.Name", caseConditon.B_Case_consultant_name, new { maxlength = "50", @readonly = "readonly", selectdialog = "selectdialog", @class = "textselect", title = "选择专业顾问", switchurl = "/sysmanager/userinfo/singlecallbackref_orgpostuserlayout?type=1&powerId=18&otype=2", dialogwidth = "1050", dialogheight = "600", lookupgroup = "consultantlookup" })<i></i></div>
                <div class="mulitytext">
                    <label>案件状态</label>
                    @{
                        IList<SelectListItem> CasestaItems = new List<SelectListItem>();
                        CasestaItems.Add(selectItemone);
                        foreach (var item in Casesta)
                        {
                            if (item.C_Parameters_id != 345)
                            {
                                SelectListItem selectItem = new SelectListItem();
                                selectItem.Value = item.C_Parameters_id.ToString();
                                selectItem.Text = item.C_Parameters_name;
                                if (caseConditon.B_Case_state != null)
                                {
                                    if (caseConditon.B_Case_state.Value == item.C_Parameters_id)
                                    {
                                        selectItem.Selected = true;
                                    }
                                }
                                CasestaItems.Add(selectItem);
                            }
                        }
                    }
                    @Html.DropDownList("B_Case_state", CasestaItems)<i></i>
                </div>
                <div class="mulitytext"><label>涉案项目</label>@Html.Hidden("projectlookup.Code", caseConditon.C_Project_code, new { lookupgroup = "projectlookup" })@Html.TextBox("projectlookup.Name", caseConditon.C_Project_name, new { maxlength = "200", @readonly = "readonly", selectdialog = "selectdialog", @class = "textselect", title = "选择工程", requiredInput = "请选择工程名称", switchurl = "/baseData/involved_project/SingleCallbackRefList?checkedProjectCode=", dialogwidth = "1080", dialogheight = "520", lookupgroup = "projectlookup" })<i></i></div>
                <div class="mulitytext"><label>法院</label>@Html.Hidden("courtlookupOne.Code", caseConditon.B_Case_courtFirst, new { lookupgroup = "courtlookupOne" })@Html.TextBox("courtlookupOne.Name", caseConditon.B_Case_courtFirstName, new { maxlength = "200", @readonly = "readonly", selectdialog = "selectdialog", @class = "textselect", title = "单选法院", requiredInput = "请选择法院名称", switchurl = "/baseData/court/SingleCallbackRefList?type=1", dialogwidth = "1080", dialogheight = "520", lookupgroup = "courtlookupOne" })<i></i></div>
                <div class="mulitytext">
                    <label>案件类型</label>
                    @{
                        IList<SelectListItem> casetypeTypeItems = new List<SelectListItem>();
                        casetypeTypeItems.Add(selectItemone);
                        foreach (var casetypeType in Casetype)
                        {
                            SelectListItem selectItem = new SelectListItem();
                            selectItem.Value = casetypeType.C_Parameters_id.ToString();
                            selectItem.Text = casetypeType.C_Parameters_name;
                            if (caseConditon.B_Case_type != null)
                            {
                                if (caseConditon.B_Case_type.Value == casetypeType.C_Parameters_id)
                                {
                                    selectItem.Selected = true;
                                }
                            }
                            casetypeTypeItems.Add(selectItem);
                        }
                    }
                    @Html.DropDownList("B_Case_type", casetypeTypeItems)<i></i>
                </div>
                <div class="mulitytext">
                    <label>办案阶段</label>
                    @{
                        IList<SelectListItem> caseStageItems = new List<SelectListItem>();
                        caseStageItems.Add(selectItemone);
                        foreach (var item in casestage)
                        {
                            SelectListItem selectItem = new SelectListItem();
                            selectItem.Value = item.P_Flow_code.ToString();
                            selectItem.Text = item.P_Flow_name;
                            if (caseConditon.B_Case_Stage != null)
                            {
                                if (caseConditon.B_Case_Stage.ToString() == item.P_Flow_code.ToString())
                                {
                                    selectItem.Selected = true;
                                }
                            }

                            caseStageItems.Add(selectItem);
                        }
                    }
                    @Html.DropDownList("B_Case_Stage", caseStageItems)<i></i>
                </div>
                <div class="mulitytext"><label>移交标的范围：</label>@Html.TextBox("B_Case_pricesta", caseConditon.B_Case_transferTargetMoney, new { @class = "dfinput", money = "请输入有效金额", maxlength = "50" })</div>
                <div class="mulitytext"><label>至</label>@Html.TextBox("B_Case_priceend", caseConditon.B_Case_execMoney2, new { @class = "scinput" })</div>
                <div class="mulitytext"><label>委托人</label>@Html.Hidden("clientmulitylookup.Code", caseConditon.C_Client_code, new { lookupgroup = "clientmulitylookup" })@Html.TextBox("clientmulitylookup.Name", caseConditon.C_Client_name, new { maxlength = "200", @readonly = "readonly", selectdialog = "selectdialog", @class = "textselect", title = "选择委托人", requiredInput = "请选择委托人", switchurl = "/baseData/client/SingleCallbackRefList?type=82", dialogwidth = "1080", dialogheight = "620", lookupgroup = "clientmulitylookup" })<i></i></div>
                <div class="mulitytext">
                    <label>区域</label>
                    @{
                        IList<SelectListItem> regionItems = new List<SelectListItem>();
                        regionItems.Add(selectItemone);
                        foreach (var item in RegionLists)
                        {
                            SelectListItem selectItem = new SelectListItem();
                            selectItem.Value = item.C_Region_code.ToString();
                            selectItem.Text = item.C_Region_name;
                            if (caseConditon.C_Region_code != null)
                            {
                                if (caseConditon.C_Region_code.ToString() == item.C_Region_code.ToString())
                                {
                                    selectItem.Selected = true;
                                }
                            }

                            regionItems.Add(selectItem);
                        }
                    }
                    @Html.DropDownList("C_Region_code", regionItems)
                    <i></i>
                </div>
                <div class="mulitytext"><label>部门</label>@Html.Hidden("responsibleDeptlookup.Code", caseConditon.B_Case_organizationCode == null ? "" : caseConditon.B_Case_organizationCode, new { lookupgroup = "responsibleDeptlookup" })@Html.TextBox("responsibleDeptlookup.Name", caseConditon.B_Case_organizationName, new { maxlength = "200", @readonly = "readonly", selectdialog = "selectdialog", @class = "textselect", title = "单选部门", switchurl = "/sysmanager/organization/singlecallbackreftree?sourceType=4", dialogwidth = "350", dialogheight = "530", lookupgroup = "responsibleDeptlookup" })<i></i></div>
                <div class="mulitytext"><label>首席审核时间</label>@Html.TextBox("B_Case_sureDate", caseConditon.B_Case_sureDate, new { date = "date", maxlength = "20", @readonly = "readonly", dateformat = "yyyy-MM-dd HH:mm:ss" })<i></i></div>
                <div class="mulitytext"><label>至</label>@Html.TextBox("B_Case_sureDateEnd", caseConditon.B_Case_sureDateEnd, new { date = "date", maxlength = "20", @readonly = "readonly", dateformat = "yyyy-MM-dd HH:mm:ss" })<i></i></div>
            </div>
        </ul>
    }
</li>
    <table class="tablelist">
        <thead>
            <tr>
                <th width="8%">案件级别</th>
                <th width="*">原告/被告</th>
                <th width="8%">稽查情况</th>
                <th width="8%">进程状态</th>
                <th width="8%">任务阶段</th>
                <th width="8%">预收案时间</th>
                <th width="8%">案件类型</th>
                <th width="8%">案件状态</th>
                <th width="8%">案件编码</th>
                <th width="8%">所属商机</th>
            </tr>
        </thead>
        <tbody>
            @{
                string entry_Statistics_Details = String.Empty;//进程情况
            }
            @foreach (var item in Model)
        {
            entry_Statistics_Details = String.Empty;//处理进程情况
            if (item.B_Case_Delay_Entry_Statistics_Count > 0)
            {
                entry_Statistics_Details += "<span style=color:blue;>有延期</span> ";
            }
            if (item.B_Case_HandlingState_Entry_Statistics_Count > 0 && item.B_Case_WarningSituation_Entry_Statistics_Count > 0)
            {
                entry_Statistics_Details += "<span style=color:red;>已超时</span>";
            }
            else if (item.B_Case_HandlingState_Entry_Statistics_Count > 0 && item.B_Case_WarningSituation_Entry_Statistics_Count <= 0)
            {
                entry_Statistics_Details += "<span style=color:red;>已超时</span>";
            }
            else if (item.B_Case_HandlingState_Entry_Statistics_Count <= 0 && item.B_Case_WarningSituation_Entry_Statistics_Count > 0)
            {
                entry_Statistics_Details += "<span style=color:orange;>预警</span>";
            }
            <tr target="sid_Iterm" rel="@item.B_Case_code" onclick="setck(this)" relname="@item.B_Case_name" ondblclick="openCaseExecuteView('82','案件执行','1400','860','/casemanager/caseexecute/defaultlayout?fkCode=@item.B_Case_code&fkType=@Convert.ToInt32(FlowTypeEnum.案件)','@(UIContext.Current.IsPreSetManager==true ?  "1" : "0")','@ViewBag.RoleButtonIds')">
                @{
            var isNotAudited = "";
            if (item.B_Case_isNotAudited > 0 && (UIContext.Current.PostGroupCode == PostGroup.ChiefExpert || UIContext.Current.IsPreSetManager))
            {
                isNotAudited = "<img src=\"/Theme/images/d02.png\" width=\"20\" height=\"20\">";
            }
                }
                <td>
                    <a target="popdialog_owndefine" title="转化审核" dialogwidth="1100" dialogheight="800" href="/casemanager/case/CaseTransformation?caseCode=@item.B_Case_code&type=2">@Html.Raw(isNotAudited)</a>
                    <a title="级别变更记录" id="LevelChange_@item.B_Case_id" onmouseout="omout_caseGrade()" onclick="omover_caseGrade('LevelChange_@item.B_Case_id', 'caseGradeDetails','/CaseManager/Case/ChangeRecordLevel?caseCode=@item.B_Case_code')">@item.B_Case_caseGrade</a>
                </td>
                <td><a class="aaa">@item.B_Case_name</a></td>
                @if (item.B_Case_IsCheckAuthority)
                {
                    <td><a style="color:blue;" title="稽查情况" id="checkAuthority_@item.B_Case_id" onmouseout="omout_checkAuthority()" onclick="omover_checkAuthority('checkAuthority_@item.B_Case_id', 'checkAuthorityDetails','/Milepost/CheckAuthority/CheckAuthorityStatistics?pkCode=@item.B_Case_code')">被稽查</a></td>
                }
                else
                {
                    <td></td>
                }
                <td><a title="进程情况" id="entryChange_@item.B_Case_id" onmouseout="omout_entryChange()" onclick="omover_entryChange('entryChange_@item.B_Case_id', 'entityChangeDetails','/MonitorManager/Entry_Change/EntryChangeRecord?pkCode=@item.B_Case_code')">@Html.Raw(entry_Statistics_Details)</a></td>
                @{
            if (item.B_Case_state == 199)
            {
                <td><a title="查看流程" id="Td_@item.B_Case_id">查看流程</a></td>
            }
            else
            {
                <td><a title="查看流程" id="Td_@item.B_Case_id" onmouseout="omout_Tj2()" onclick="omover_Tj('Td_@item.B_Case_id', 'tjjyDetails','/flowmanager/businessflow/pkrelationbusinessflowlist2?pkCode=@item.B_Case_code&businessFlowCode=&fkType=@Convert.ToInt32(FlowTypeEnum.案件)')">查看流程</a></td>
            }
                }
                <td>@(item.B_Case_registerTime == null ? "" : item.B_Case_registerTime.Value.ToString("yyyy-MM-dd"))</td>
                @{
            var casetype = Casetype.Where(c => c.C_Parameters_id == item.B_Case_type).FirstOrDefault();
                }
                @if (casetype != null)
                {
                    <td>@casetype.C_Parameters_name</td>
                }
                else
                {
                    <td></td>
                }
                @{
                var casestate = Case_state.Where(c => c.C_Parameters_id == item.B_Case_state).FirstOrDefault();
                var color = "";
                if (casestate != null)
                {
                    if (casestate.C_Parameters_id == Convert.ToInt32(BusinessFlowStatus.未开始))
                    {
                        color = "#C25812";
                    }
                    else if (casestate.C_Parameters_id == Convert.ToInt32(BusinessFlowStatus.正在进行))
                    {
                        color = "#126558";
                    }
                    else if (casestate.C_Parameters_id == Convert.ToInt32(BusinessFlowStatus.已超时))
                    {
                        color = "#0033CC";

                    }
                    else
                    {
                        color = "#85B4F2";
                    }
                }
                }
                @if (casestate != null)
                {
                    <td style="color:@color;">@casestate.C_Parameters_name</td>
                }
                else
                {
                    <td></td>
                }
                <td>@item.B_Case_number</td>
                <td title="@item.B_Case_businessChance_Name"><a target="popdialog_owndefine" title="商机执行" dialogwidth="1400" dialogheight="830" edit="edit" href="/casemanager/caseexecute/businesschancedefaultlayout?fkCode=@item.B_Case_businessChance_Code&fkType=@Convert.ToInt32(FlowTypeEnum.商机)">@Maticsoft.Common.Cutout.Cut(item.B_Case_businessChance_Name, 20)</a></td>
            </tr>
        }
        </tbody>
    </table>

    <div id="tjjyDetails" trlabid="" trid="" trclient_url="" onmouseout="omout_Tj(this)" onmouseover="omover2(this)" class="tjjyDetails" style="overflow: auto; border: 1px solid #000000; display:none; background-color:white; height:180px;">
        <table border="1" cellpadding="5" cellspacing="5" style=" margin-left: 10px; width: 400px;">
            <tr style="height:180px; width:400px;">
                <td align="center" width="400">
                    <img src="/Theme/assets/global/plugins/slider-revolution-slider/rs-plugin/assets/loader2.gif" /> 加载中...
                </td>
            </tr>
        </table>
    </div>
    <!--进程条目变更信息容器-->
    <div id="entityChangeDetails" trlabid="" trid="" trclient_url="" onmouseout="omout_Tj(this)" onmouseover="omover2(this)" class="tjjyDetails" style="overflow: auto; border: 1px solid #000000; display:none; background-color:white; height:180px;">
      <table border="1" cellpadding="5" cellspacing="5" style=" margin-left: 10px; width: 900px;">
        <tr style="height: 180px; width: 900px;">
            <td align="center" width="900px">
                <img src="/Theme/assets/global/plugins/slider-revolution-slider/rs-plugin/assets/loader2.gif" /> 加载中...
            </td>
        </tr>
      </table>
    </div>
    <!--稽查情况容器-->    
    <div id="checkAuthorityDetails" trlabid="" trid="" trclient_url="" onmouseout="omout_Tj(this)" onmouseover="omover2(this)" class="tjjyDetails" style="overflow: auto; border: 1px solid #000000; display:none; background-color:white; height:180px; width:400px;">
        <table border="1" cellpadding="5" cellspacing="5" style="width: 400px;">
            <tr style="height: 180px;">
                <td align="center">
                    <img src="/Theme/assets/global/plugins/slider-revolution-slider/rs-plugin/assets/loader2.gif" /> 加载中...
                </td>
            </tr>
        </table>
    </div>
    <!--级别变更记录-->
    <div id="caseGradeDetails" trlabid="" trid="" trclient_url="" onmouseout="omout_Tj(this)" onmouseover="omover2(this)" class="tjjyDetails" style="overflow: auto; border: 1px solid #000000; display:none; background-color:white; height:180px;">
        <table border="1" cellpadding="5" cellspacing="5" style=" margin-left: 10px; width: 400px;">
            <tr style="height:180px; width:400px;">
                <td align="center" width="400">
                    <img src="/Theme/assets/global/plugins/slider-revolution-slider/rs-plugin/assets/loader2.gif" /> 加载中...
                </td>
            </tr>
        </table>
    </div>
    <script>
        var status = 0;
        //点击进程状态
        function omover_entryChange(obj, id, client_url) {
            $.ajax({
                type: "POST",
                async: true,
                url: client_url,
                success: function (result) {
                    $("#" + id).html(result);
                }
            })

            var toplab = getAbsoluteTop(obj);
            var leftlab = getAbsoluteLeft(obj);

            //初始化
            $("#entityChangeDetails").css("display", "none");
            $("#entityChangeDetails").attr("trlabid", obj);
            $("#entityChangeDetails").attr("trid", id);
            $("#entityChangeDetails").attr("client_url", client_url);

            var objDiv = $("#" + id + "");
            var xPoint = window.event.clientX;
            objDiv.attr("style", "position:absolute; left:" + (leftlab + 25) + "px; top:" + (toplab - 80) + "px; overflow: auto;background-color:white; border: 1px solid #000000; height:180px;width:900px");
            $(objDiv).css("display", "block");
        }
        //影藏进程条目变更信息容器
        function omout_entryChange() {
            $("#entityChangeDetails").hide();
        }

        //点击稽查情况
        function omover_checkAuthority(obj, id, client_url) {
            $.ajax({
                type: "POST",
                async: true,
                url: client_url,
                success: function (result) {
                    $("#" + id).html(result);
                }
            })

            var toplab = getAbsoluteTop(obj);
            var leftlab = getAbsoluteLeft(obj);

            //初始化
            $("#checkAuthorityDetails").css("display", "none");
            $("#checkAuthorityDetails").attr("trlabid", obj);
            $("#checkAuthorityDetails").attr("trid", id);
            $("#checkAuthorityDetails").attr("client_url", client_url);

            var objDiv = $("#" + id + "");
            var xPoint = window.event.clientX;
            objDiv.attr("style", "position:absolute; left:" + (leftlab + 25) + "px; top:" + (toplab - 80) + "px; overflow: auto;background-color:white; border: 1px solid #000000; height:180px;width:400px");
            $(objDiv).css("display", "block");
        }
        //点击案件级别
        function omover_caseGrade(obj, id, client_url)
        {
            $.ajax({
                type: "POST",
                async: true,
                url: client_url,
                success: function (result) {
                    $("#" + id).html(result);
                }
            })
            var toplab = getAbsoluteTop(obj);
            var leftlab = getAbsoluteLeft(obj);

            //初始化
            $("#caseGradeDetails").css("display", "none");
            $("#caseGradeDetails").attr("trlabid", obj);
            $("#caseGradeDetails").attr("trid", id);
            $("#caseGradeDetails").attr("client_url", client_url);

            var objDiv = $("#" + id + "");
            var xPoint = window.event.clientX;
            objDiv.attr("style", "position:absolute; left:" + (leftlab + 25) + "px; top:" + (toplab - 80) + "px; overflow: auto;background-color:white; border: 1px solid #000000; height:180px;width:400px");
            $(objDiv).css("display", "block");
        }
        //隐藏案件级别容器
        function omout_caseGrade() {
            $("#caseGradeDetails").hide();
        }
        //影藏稽查情况容器
        function omout_checkAuthority() {
            $("#checkAuthorityDetails").hide();
        }

        function omover_Tj(obj, id, client_url) {
            $.ajax({
                type: "POST",
                async: true,
                url: client_url,
                success: function (result) {
                    $("#" + id).html(result);
                }
            })

            var toplab = getAbsoluteTop(obj);
            var leftlab = getAbsoluteLeft(obj);

            //初始化
            $("#tjjyDetails").css("display", "none");
            $("#tjjyDetails").attr("trlabid", obj);
            $("#tjjyDetails").attr("trid", id);
            $("#tjjyDetails").attr("client_url", client_url);

            var objDiv = $("#" + id + "");
            var xPoint = window.event.clientX;
            objDiv.attr("style", "position:absolute; left:" + (leftlab + 45) + "px; top:" + (toplab - 80) + "px; overflow: auto;background-color:white; border: 1px solid #000000; height:180px;");
            $(objDiv).css("display", "block");
        }

        function omover2(val) {
            var objDiv = $("#" + $(val).attr("trid") + "");
            $(objDiv).css("display", "block");
        }
        function omout_Tj(val) {
            var objDiv = $("#" + $(val).attr("trid") + "");
            $(objDiv).css("display", "none");
        }

        function omout_Tj2() {
            $("#tjjyDetails").hide();
        }

        //获取控件左绝对位置
        function getAbsoluteLeft(objectId) {
            var lo = document.getElementById(objectId)
            oLeft = lo.offsetLeft
            while (lo.offsetParent != null) {
                oParent = lo.offsetParent
                oLeft += oParent.offsetLeft
                lo = oParent
            }
            return oLeft
        }
        //获取控件上绝对位置
        function getAbsoluteTop(objectId) {
            var o = document.getElementById(objectId);
            oTop = o.offsetTop;
            while (o.offsetParent != null) {
                oParent = o.offsetParent
                oTop += oParent.offsetTop  // Add parent top position
                o = oParent
            }
            return oTop
        }
        //执行查询
        function osbselect(val) {
            document.getElementById("@ViewBag.SearchFormID").action = val + '?caseType=@ViewBag.caseType';
            document.getElementById("@ViewBag.SearchFormID").submit();
        }
        //设置担任主办，担任协办点击触发业务类型
        function setLawyerType(lawyerType) {
            $('#lawyerType').val(lawyerType);
            osbselect('/casemanager/case/List');
        }
    </script>
