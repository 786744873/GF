@using System.Data;
@using CommonService.Common;
@{
    Layout = null;
}
@model IEnumerable<CommonService.Model.CustomerForm.F_FormProperty>
<!-- BEGIN PAGE HEADER-->
@{Html.RenderAction("OAContentPageHead");}
<!-- END PAGE HEADER-->
<!-- BEGIN PAGE CONTENT-->
@{
    string formName = ViewBag.FormName;//表单名称
    bool isFreeFlow = ViewBag.IsFreeFlow;//是否自由流程
    string isFreeFlowStr = isFreeFlow ? "1" : "0";
    string fFormCode = ViewBag.FFormCode;//ERP表单Guid
    string oFormCode = ViewBag.OFormCode;//协同办公表单Guid
    int applyStatus = ViewBag.ApplyStatus;//申请状态
    string businessFlowFormCode = ViewBag.BusinessFlowFormCode;//ERP业务流程表单关联Guid
    DataSet DynamicFormPropertyValues = ViewBag.DynamicFormPropertyValues;//动态表单属性值
    CommonService.Model.CaseManager.B_Case caseModel = ViewBag.caseModel;
}
@{
    var itemGourp = Model.Where(p => p.F_FormProperty_uiType == Convert.ToInt32(UiControlType.普通子表));//明细组(有多少个明细子表)
}
<div class="row">
    <div class="col-md-12">
        <div class="portlet">
            <div class="portlet-title">
                <div class="caption">
                    <i class="fa fa-shopping-cart"></i>我的表单
                </div>
                <div class="actions btn-set">
                    @*<button type="button" name="back" class="btn default"><i class="fa fa-angle-left"></i>返回</button>*@
                    <a class="btn ajaxify" href="/oa/form/List">
                        返回
                    </a>
                </div>
            </div>
            <div class="portlet-body">
                <div class="tabbable">
                    <ul class="nav nav-tabs">
                        <li class="active">
                            <a href="#tab_form" data-toggle="tab">
                                @formName
                            </a>
                        </li>
                        @if (applyStatus != Convert.ToInt32(FormApplyTypeEnum.未提交))
                        {
                            <li>
                                <a href="#tab_audit" data-toggle="tab">
                                    审批流程
                                </a>
                            </li>
                        }
                    </ul>
                    <div class="tab-content no-space">
                        <div class="tab-pane active" id="tab_form">
                            <div class="light bg-inverse">
                                <div class="portlet-body form">
                                    <!-- BEGIN FORM-->
                                    <form id="customerItemsForm" action="/oa/form/savesingleitem" class="form-horizontal" method="post">
                                        <div class="form-body">
                                            <div class="alert alert-danger display-hide">
                                                <button class="close" data-close="alert"></button>
                                                <span defaulttext="表单数据不完整，请检查红色部分！"></span>
                                            </div>
                                            <div class="alert alert-success display-hide">
                                                <button class="close" data-close="alert"></button>
                                                <span defaulttext="表单数据验证通过，数据处理中..."></span>
                                            </div>
                                            <input type="hidden" name="fFormCode" value="@fFormCode" />
                                            <input type="hidden" name="oFormCode" value="@oFormCode" />
                                            <input type="hidden" name="isFreeFlow" value="@isFreeFlowStr" />
                                            <input type="hidden" name="businessFlowFormCode" value="@businessFlowFormCode" />
                                            <input type="hidden" name="operateType" value="1" />
                                            @foreach (var group in itemGourp)
                                            {
                                                int childItemNum = Model.Where(p => p.F_FormProperty_parent == group.F_FormProperty_code).Count();//子属性数量
                                                string itemGroupValue = group.F_FormProperty_id + "_" + childItemNum;
                                                <input type="hidden" name="itemGroup_@group.F_FormProperty_id" value="@itemGroupValue" />
                                            }
                                            @{
                                                string id = String.Empty;
                                                string relid = String.Empty;
                                                string relname = String.Empty;
                                                string name = String.Empty;
                                                string defaultValue = String.Empty;//属性默认值
                                                string propertyValue = String.Empty;//属性值
                                                string propertyId = String.Empty;//属性id
                                                string tempPropertyValue = String.Empty;//临时属性值
                                                string htmlAttributes = String.Empty;
                                                string htmlcontent = String.Empty;
                                                string validateType = String.Empty;
                                                string validateMessage = String.Empty;
                                                string relRefUi = String.Empty;
                                                string refUi = String.Empty;//关联UI控件名称
                                                string refUrl = String.Empty;//关联异步地址
                                                string isOnlyRead = "0";//是否只读属性
                                                string isRequireValidate = "0";//是否要求验证
                                                string eventFunction = String.Empty;//事件
                                                string triggerEventType = String.Empty;//触发事件类型
                                                string dynamicJs = String.Empty;//动态js
                                            }
                                            @foreach (var group in itemGourp)
                                            {
                                                <div class="table-toolbar">
                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            @if (caseModel != null)
                                                            {
                                                                <div class="btn-group">
                                                                        <p>

                                                                            @if (caseModel.B_Case_name != null && caseModel.B_Case_number != null)
                                                                            {
                                                                                <span>@caseModel.B_Case_name</span><span>(</span><span>@caseModel.B_Case_number</span><span>)</span><span>>></span>
                                                                            }
                                                                            @if (caseModel.P_business_flow_name != null)
                                                                            {
                                                                                <span>@caseModel.P_business_flow_name</span><span>>></span>
                                                                            }
                                                                            @if (caseModel.F_form_name != null)
                                                                            {
                                                                                <span>@caseModel.F_form_name</span>
                                                                            }

                                                                        </p>
                                                                </div>
                                                            }
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <div class="btn-group">
                                                                <a class="btn green" id="table_addbutton_@group.F_FormProperty_id">
                                                                    新增 <i class="fa fa-plus"></i>
                                                                </a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="table-scrollable">
                                                    <table id="table_@group.F_FormProperty_id" class="table table-striped table-bordered table-hover" style="color: #333; width: 1600px !important; " relationbutton="table_addbutton_@group.F_FormProperty_id">
                                                        <thead>
                                                            <tr>
                                                                @{
                                                var groupItems = Model.Where(p => p.F_FormProperty_parent == group.F_FormProperty_code);
                                                                }
                                                                @foreach (var groupItem in groupItems)
                                                                {
                                                                    id = String.Empty;
                                                                    name = String.Empty;
                                                                    defaultValue = String.Empty;
                                                                    htmlAttributes = String.Empty;
                                                                    validateType = String.Empty;
                                                                    validateMessage = String.Empty;
                                                                    refUi = String.Empty;
                                                                    refUrl = String.Empty;
                                                                    eventFunction = String.Empty;
                                                                    triggerEventType = String.Empty;
                                                                    dynamicJs = String.Empty;

                                                                    id = "items_index_" + groupItem.F_FormProperty_fieldName;
                                                                    name = "items_" + group.F_FormProperty_id + "_index_" + groupItem.F_FormProperty_fieldName + "_" + groupItem.F_FormProperty_id;
                                                                    defaultValue = groupItem.F_FormProperty_defaultValue;
                                                                    if (!groupItem.F_FormProperty_isShow)
                                                                    {
                                                                        <th scope="col" class="hide" uitype="hid" id="@id" name="@name" defaultval="@defaultValue">@groupItem.F_FormProperty_showName</th>
                                                                        continue;
                                                                    }

                                                                    isOnlyRead = "0";//是否只读属性
                                                                    if (groupItem.F_FormProperty_isOnlyRead)
                                                                    {
                                                                        isOnlyRead = "1";
                                                                    }
                                                                    isRequireValidate = "0";//是否要求验证
                                                                    if (groupItem.F_FormProperty_isRequire)
                                                                    {
                                                                        isRequireValidate = "1";
                                                                        validateType += "required:true,";
                                                                        validateMessage += "required:'请输入" + groupItem.F_FormProperty_showName + "',";
                                                                    }
                                                                    //处理其它验证
                                                                    string otherValidateStr = groupItem.F_FormProperty_validationMessage;
                                                                    if (!String.IsNullOrEmpty(otherValidateStr))
                                                                    {
                                                                        string[] validateMessageGroup = otherValidateStr.Split('|');
                                                                        for (int i = 0; i < validateMessageGroup.Length; i++)
                                                                        {
                                                                            string lowerValidateMessage = validateMessageGroup[i].ToLower();//转换为小写
                                                                            //转换ERP表单中的整数验证为OA整数验证的格式
                                                                            if (lowerValidateMessage.Contains("positiveinteger"))
                                                                            {
                                                                                validateType += "digits:true,";
                                                                                validateMessage += lowerValidateMessage.Replace("\"", "").Replace("positiveinteger=", "digits:'") + "',";//替换验证信息中存在的双引号
                                                                            }
                                                                            //转换ERP表单中的金额验证为OA金额验证的格式
                                                                            if (lowerValidateMessage.Contains("money"))
                                                                            {
                                                                                validateType += "number:true,";
                                                                                validateMessage += lowerValidateMessage.Replace("\"", "").Replace("money=", "number:'") + "',";//替换验证信息中存在的双引号
                                                                            }
                                                                        }
                                                                    }
                                                                    if (!String.IsNullOrEmpty(validateType))
                                                                    {
                                                                        validateType = "validateType=" + validateType;
                                                                    }
                                                                    if (!String.IsNullOrEmpty(validateMessage))
                                                                    {
                                                                        validateMessage = validateMessage.Substring(0, validateMessage.Length - 1);
                                                                        validateMessage = "validateMessage=" + validateMessage + "";
                                                                    }
                                                                    if (groupItem.F_FormProperty_triggerEvent_Type == Convert.ToInt32(TriggerEventTypeEnum.改变事件))
                                                                    {//处理触发事件
                                                                        groupItem.F_FormProperty_triggerEvent_dynamicJs = groupItem.F_FormProperty_triggerEvent_dynamicJs.Replace(" ", "");
                                                                        dynamicJs = "" + Server.UrlEncode(groupItem.F_FormProperty_triggerEvent_dynamicJs) + " ";
                                                                        triggerEventType = groupItem.F_FormProperty_triggerEvent_Type == null ? "" : groupItem.F_FormProperty_triggerEvent_Type.ToString();
                                                                    }

                                                                    switch (groupItem.F_FormProperty_uiType.Value)
                                                                    {
                                                                        case 133://下拉框
                                                                        case 682://联动下拉框
                                                                            MvcHtmlString mvcHtmlStr = Html.Action("GenerateTableEditListDropDownHtmls", new { formPropertyValue = @groupItem });
                                                                            htmlcontent = mvcHtmlStr.ToString();
                                                                            if (!String.IsNullOrEmpty(groupItem.F_FormProperty_targetUrl))
                                                                            {
                                                                                if (groupItem.F_FormProperty_targetUrl.ToLower().Contains("refui"))
                                                                                {//代表有关联触发联动UI控件,举例：/demo/combox/area?refui=dkxz&para=20(refui=dkxz必须为第一参数)
                                                                                    //拆分目标链接地址
                                                                                    string[] urlGroup = groupItem.F_FormProperty_targetUrl.Split('?');
                                                                                    refUrl = groupItem.F_FormProperty_targetUrl;
                                                                                    string[] paraGroup = urlGroup[1].Split('&');
                                                                                    string[] uiGroup = paraGroup[0].Split('=');
                                                                                    refUi = uiGroup[1];
                                                                                    //处理被触发联动UI控件,重新组织 refUi控件的值
                                                                                    var refGroupItem = Model.Where(p => p.F_FormProperty_parent == group.F_FormProperty_code && p.F_FormProperty_fieldName == refUi).FirstOrDefault();
                                                                                    if (refGroupItem != null)
                                                                                    {
                                                                                        //refUi = "items_" + group.F_FormProperty_id + "_index_" + refGroupItem.F_FormProperty_fieldName + "_" + refGroupItem.F_FormProperty_id;
                                                                                        refUi = "items_index_" + refGroupItem.F_FormProperty_fieldName;
                                                                                    }
                                                                                }
                                                                            }
                                                                            break;
                                                                    }
                                                                    <th scope="col" uitype="@groupItem.F_FormProperty_uiType" id="@id" name="@name" defaultval="@defaultValue" size="@groupItem.F_FormProperty_fieldLength" isonlyread="@isOnlyRead" isrequirevalidate="@isRequireValidate" @validateType @validateMessage refui="@refUi" refurl="@refUrl" htmlcontent="@htmlcontent" triggereventtype="@triggerEventType" dynamicjs="@dynamicJs">@groupItem.F_FormProperty_showName</th>
                                                                }
                                                                <th scope="col" uitype="del">操作</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            @for (int j = 0; j < DynamicFormPropertyValues.Tables.Count; j++)
                                                            {//这个地方的业务逻辑都为处理加载列表表单属性值
                                                                DataTable dt = DynamicFormPropertyValues.Tables[j];
                                                                bool isThisTable = false;//是否为普通子表属性关联table
                                                                int columnCount = 0;//table 列数量
                                                                foreach (var groupItem in groupItems)
                                                                {
                                                                    if (dt.Columns.Contains(groupItem.F_FormProperty_code.Value.ToString().ToUpper()))
                                                                    {
                                                                        isThisTable = true;
                                                                        columnCount = dt.Columns.Count;
                                                                        break;
                                                                    }
                                                                }
                                                                if (isThisTable)
                                                                {
                                                                    int rowIndex = 0;//行索引号
                                                                    foreach (DataRow dr in dt.Rows)
                                                                    {
                                                                        <tr>
                                                                            @foreach (var groupItem in groupItems)
                                                                            {
                                                                                id = String.Empty;
                                                                                relid = String.Empty;
                                                                                relname = String.Empty;
                                                                                name = String.Empty;

                                                                                htmlAttributes = String.Empty;
                                                                                htmlcontent = String.Empty;
                                                                                validateType = String.Empty;
                                                                                validateMessage = String.Empty;
                                                                                propertyId = String.Empty;
                                                                                propertyValue = String.Empty;
                                                                                tempPropertyValue = String.Empty;
                                                                                refUi = String.Empty;
                                                                                relRefUi = String.Empty;
                                                                                refUrl = String.Empty;
                                                                                eventFunction = String.Empty;
                                                                                dynamicJs = String.Empty;
                                                                                triggerEventType = String.Empty;

                                                                                tempPropertyValue = dr[groupItem.F_FormProperty_code.Value.ToString().ToUpper()].ToString();
                                                                                if (!String.IsNullOrEmpty(tempPropertyValue))
                                                                                {
                                                                                    if (tempPropertyValue.Substring(0, 1) == "[")
                                                                                    {
                                                                                        tempPropertyValue = tempPropertyValue.Substring(1, tempPropertyValue.Length - 1);
                                                                                        int charIndex = tempPropertyValue.IndexOf(']');
                                                                                        propertyId = tempPropertyValue.Substring(0, charIndex);
                                                                                        propertyValue = tempPropertyValue.Substring(charIndex + 1, tempPropertyValue.Length - charIndex - 1);
                                                                                    }
                                                                                }

                                                                                id = "items_" + rowIndex + "_" + groupItem.F_FormProperty_fieldName;
                                                                                relid = "items_index_" + groupItem.F_FormProperty_fieldName;
                                                                                name = "items_" + group.F_FormProperty_id + "_" + rowIndex + "_" + groupItem.F_FormProperty_fieldName + "_" + groupItem.F_FormProperty_id + "_" + propertyId;
                                                                                relname = "items_" + group.F_FormProperty_id + "_index_" + groupItem.F_FormProperty_fieldName + "_" + groupItem.F_FormProperty_id + "_" + propertyId;
                                                                                if (!groupItem.F_FormProperty_isShow)
                                                                                {
                                                                                    <td class="hide"><input type="hidden" id="@id" relid="@relid" name="@name" relname="@relname" value="@propertyValue" /></td>
                                                                                    continue;
                                                                                }
                                                                                if (groupItem.F_FormProperty_isRequire)
                                                                                {
                                                                                    validateType += "required:true,";
                                                                                    validateMessage += "required:'请输入" + groupItem.F_FormProperty_showName + "',";
                                                                                }
                                                                                if (groupItem.F_FormProperty_isOnlyRead)
                                                                                {
                                                                                    if (groupItem.F_FormProperty_uiType.Value == 133)
                                                                                    {
                                                                                        htmlAttributes += "disabled=disabled ";
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        htmlAttributes += "readonly=readonly ";
                                                                                    }
                                                                                }
                                                                                //处理其它验证
                                                                                string otherValidateStr = groupItem.F_FormProperty_validationMessage;
                                                                                if (!String.IsNullOrEmpty(otherValidateStr))
                                                                                {
                                                                                    string[] validateMessageGroup = otherValidateStr.Split('|');
                                                                                    for (int i = 0; i < validateMessageGroup.Length; i++)
                                                                                    {
                                                                                        string lowerValidateMessage = validateMessageGroup[i].ToLower();//转换为小写
                                                                                        //转换ERP表单中的整数验证为OA整数验证的格式
                                                                                        if (lowerValidateMessage.Contains("positiveinteger"))
                                                                                        {
                                                                                            validateType += "digits:true,";
                                                                                            validateMessage += lowerValidateMessage.Replace("\"", "").Replace("positiveinteger=", "digits:'") + "',";//替换验证信息中存在的双引号
                                                                                        }
                                                                                        //转换ERP表单中的金额验证为OA金额验证的格式
                                                                                        if (lowerValidateMessage.Contains("money"))
                                                                                        {
                                                                                            validateType += "number:true,";
                                                                                            validateMessage += lowerValidateMessage.Replace("\"", "").Replace("money=", "number:'") + "',";//替换验证信息中存在的双引号
                                                                                        }
                                                                                    }
                                                                                }
                                                                                htmlAttributes += "maxlength=" + groupItem.F_FormProperty_fieldLength + " ";
                                                                                if (!String.IsNullOrEmpty(validateType))
                                                                                {
                                                                                    validateType = validateType.Substring(0, validateType.Length - 1);
                                                                                    validateType = "validateType={" + validateType + "}";
                                                                                }
                                                                                if (!String.IsNullOrEmpty(validateMessage))
                                                                                {
                                                                                    validateMessage = validateMessage.Substring(0, validateMessage.Length - 1);
                                                                                    validateMessage = "validateMessage={" + validateMessage + "}";
                                                                                }
                                                                                if (groupItem.F_FormProperty_triggerEvent_Type == Convert.ToInt32(TriggerEventTypeEnum.改变事件))
                                                                                {//处理触发事件
                                                                                    eventFunction = " onchange=text_change(this) ";
                                                                                    triggerEventType = " triggerEventType=" + groupItem.F_FormProperty_triggerEvent_Type + " ";
                                                                                    //去掉动态js里可能存在的空格,否则js解码时,会出现乱码问题,hety,2015-09-12,因为目前没有找到解决C#编码后,对应js解码正确的函数
                                                                                    groupItem.F_FormProperty_triggerEvent_dynamicJs = groupItem.F_FormProperty_triggerEvent_dynamicJs.Replace(" ", "");
                                                                                    dynamicJs = " dynamicJs=" + Server.UrlEncode(groupItem.F_FormProperty_triggerEvent_dynamicJs) + " ";
                                                                                }
                                                                                switch (groupItem.F_FormProperty_uiType.Value)
                                                                                {
                                                                                    case 129://单行文本框
                                                                                        if (groupItem.F_FormProperty_isRequire)
                                                                                        {
                                                                                            <td>
                                                                                                <div class="form-group">
                                                                                                    <div class="col-md-12">
                                                                                                        <div class="input-icon right">
                                                                                                            <i class="fa"></i>
                                                                                                            <input type="text" class="form-control" id="@id" relid="@relid" name="@name" relname="@relname" value="@propertyValue" @htmlAttributes @validateType @validateMessage @eventFunction @triggerEventType @dynamicJs />
                                                                                                        </div>
                                                                                                    </div>
                                                                                                </div>
                                                                                            </td>
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <td>
                                                                                                <div class="form-group">
                                                                                                    <div class="col-md-12">
                                                                                                        <input type="text" class="form-control" id="@id" relid="@relid" name="@name" relname="@relname" value="@propertyValue" @htmlAttributes @validateType @validateMessage @eventFunction @triggerEventType @dynamicJs />
                                                                                                    </div>
                                                                                                </div>
                                                                                            </td>
                                                                                        }
                                                                                        break;
                                                                                    case 130://多行文本框
                                                                                        if (groupItem.F_FormProperty_isRequire)
                                                                                        {
                                                                                            <td>
                                                                                                <div class="form-group">
                                                                                                    <div class="col-md-12">
                                                                                                        <div class="input-icon right">
                                                                                                            <i class="fa"></i>
                                                                                                            <textarea class="form-control input-sm" cols="20" id="@id" relid="@relid" name="@name" relname="@relname" rows="2" @htmlAttributes @validateType @validateMessage>@propertyValue</textarea>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                </div>
                                                                                            </td>
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <td>
                                                                                                <div class="form-group">
                                                                                                    <div class="col-md-12">
                                                                                                        <textarea class="form-control input-sm" cols="20" id="@id" relid="@relid" name="@name" relname="@relname" rows="2" @htmlAttributes @validateType @validateMessage>@propertyValue</textarea>
                                                                                                    </div>
                                                                                                </div>
                                                                                            </td>
                                                                                        }
                                                                                        break;
                                                                                    case 133://下拉框
                                                                                        groupItem.V_FormPropertyValue_Value = propertyValue;
                                                                                        MvcHtmlString mvcHtmlStr = Html.Action("GenerateTableEditListDropDownHtmls", new { formPropertyValue = @groupItem });
                                                                                        htmlcontent = mvcHtmlStr.ToString();
                                                                                        if (!String.IsNullOrEmpty(groupItem.F_FormProperty_targetUrl))
                                                                                        {//可以触发关联下拉框的下拉框
                                                                                            if (groupItem.F_FormProperty_targetUrl.ToLower().Contains("refui"))
                                                                                            {//代表有关联触发联动UI控件,举例：/demo/combox/area?refui=dkxz&para=20(refui=dkxz必须为第一参数)
                                                                                                //拆分目标链接地址
                                                                                                string[] urlGroup = groupItem.F_FormProperty_targetUrl.Split('?');
                                                                                                refUrl = groupItem.F_FormProperty_targetUrl;
                                                                                                string[] paraGroup = urlGroup[1].Split('&');
                                                                                                string[] uiGroup = paraGroup[0].Split('=');
                                                                                                refUi = uiGroup[1];
                                                                                                //处理被触发联动UI控件,重新组织 refUi控件的值
                                                                                                var refGroupItem = Model.Where(p => p.F_FormProperty_parent == group.F_FormProperty_code && p.F_FormProperty_fieldName == refUi).FirstOrDefault();
                                                                                                if (refGroupItem != null)
                                                                                                {
                                                                                                    //relRefUi = "items_" + group.F_FormProperty_id + "_index_" + refGroupItem.F_FormProperty_fieldName + "_" + refGroupItem.F_FormProperty_id;
                                                                                                    //refUi = "items_" + group.F_FormProperty_id + "_" + rowIndex + "_" + refGroupItem.F_FormProperty_fieldName + "_" + refGroupItem.F_FormProperty_id;
                                                                                                    relRefUi = "items_index_" + refGroupItem.F_FormProperty_fieldName;
                                                                                                    refUi = "items_" + rowIndex + "_" + refGroupItem.F_FormProperty_fieldName;
                                                                                                }
                                                                                                <td>
                                                                                                    <div class="form-group">
                                                                                                        <div class="col-md-12">
                                                                                                            <select id="@id" relid="@relid" name="@name" relname="@relname" @htmlAttributes class="form-control" relrefui="@relRefUi" refui="@refUi" refurl="@refUrl" onchange="select_onchange_ref(this)">@Html.Raw(htmlcontent)</select>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                </td>
                                                                                            }
                                                                                        }
                                                                                        else
                                                                                        {//正常下拉框
                                                                                            <td>
                                                                                                <div class="form-group">
                                                                                                    <div class="col-md-12">
                                                                                                        <select id="@id" relid="@relid" name="@name" relname="@relname" @htmlAttributes class="form-control">@Html.Raw(htmlcontent)</select>
                                                                                                    </div>
                                                                                                </div>
                                                                                            </td>
                                                                                        }
                                                                                        break;
                                                                                    case 682://联动下拉框
                                                                                        var refSourceGroupItem = Model.Where(p => p.F_FormProperty_parent == group.F_FormProperty_code && p.F_FormProperty_targetUrl.ToLower().Contains("refui") && p.F_FormProperty_targetUrl.Contains(groupItem.F_FormProperty_fieldName)).FirstOrDefault();
                                                                                        if (refSourceGroupItem != null)
                                                                                        {
                                                                                            groupItem.F_FormProperty_dataSource_conditionValue = refSourceGroupItem.V_FormPropertyValue_Value;
                                                                                        }
                                                                                        groupItem.V_FormPropertyValue_Value = propertyValue;
                                                                                        MvcHtmlString mvcLinkAgeHtmlStr = Html.Action("GenerateTableEditListDropDownHtmls", new { formPropertyValue = @groupItem });
                                                                                        htmlcontent = mvcLinkAgeHtmlStr.ToString();
                                                                                        <td>
                                                                                            <div class="form-group">
                                                                                                <div class="col-md-12">
                                                                                                    <select id="@id" relid="@relid" name="@name" relname="@relname" @htmlAttributes class="form-control">@Html.Raw(htmlcontent)</select>
                                                                                                </div>
                                                                                            </div>
                                                                                        </td>
                                                                                        break;
                                                                                    case 134://日期框
                                                                                        if (groupItem.F_FormProperty_isRequire)
                                                                                        {
                                                                                            <td>
                                                                                                <div class="form-group">
                                                                                                    <div class="col-md-12">
                                                                                                        <div class="input-group input-medium date date-picker input-icon right" data-date-format="yyyy-mm-dd">
                                                                                                            <i class="fa"></i>
                                                                                                            <input type="text" class="form-control" id="@id" relid="@relid" name="@name" relname="@relname" value="@propertyValue" @htmlAttributes @validateType @validateMessage />
                                                                                                            <span class="input-group-btn">
                                                                                                                <button class="btn default" type="button"><i class="fa fa-calendar"></i></button>
                                                                                                            </span>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                </div>
                                                                                            </td>
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <td>
                                                                                                <div class="form-group">
                                                                                                    <div class="col-md-12">
                                                                                                        <div class="input-group input-medium date date-picker" data-date-format="yyyy-mm-dd">
                                                                                                            <input type="text" class="form-control" id="@id" relid="@relid" name="@name" relname="@relname" value="@propertyValue" @htmlAttributes @validateType @validateMessage />
                                                                                                            <span class="input-group-btn">
                                                                                                                <button class="btn default" type="button"><i class="fa fa-calendar"></i></button>
                                                                                                            </span>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                </div>
                                                                                            </td>
                                                                                        }
                                                                                        break;
                                                                                    case 578://时间框
                                                                                        if (groupItem.F_FormProperty_isRequire)
                                                                                        {
                                                                                            <td>
                                                                                                <div class="form-group">
                                                                                                    <div class="col-md-12">
                                                                                                        <div class="input-group input-medium  input-icon right">
                                                                                                            <i class="fa"></i>
                                                                                                            <input type="text" class="form-control timepicker" id="@id" relid="@relid" name="@name" relname="@relname" value="@propertyValue" @htmlAttributes @validateType @validateMessage />
                                                                                                            <span class="input-group-btn">
                                                                                                                <button class="btn default" type="button"><i class="fa fa-clock-o"></i></button>
                                                                                                            </span>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                </div>
                                                                                            </td>
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <td>
                                                                                                <div class="form-group">
                                                                                                    <div class="col-md-12">
                                                                                                        <div class="input-group input-medium">
                                                                                                            <input type="text" class="form-control timepicker" id="@id" relid="@relid" name="@name" relname="@relname" value="@propertyValue" @htmlAttributes @validateType @validateMessage />
                                                                                                            <span class="input-group-btn">
                                                                                                                <button class="btn default" type="button"><i class="fa fa-clock-o"></i></button>
                                                                                                            </span>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                </div>
                                                                                            </td>
                                                                                        }
                                                                                        break;
                                                                                }
                                                                            }
                                                                            <td><a href="javascript:;" class="btn default btn-sm"><i class="fa fa-times"></i> 删除</a></td>
                                                                        </tr>
                                                                            rowIndex++;
                                                                    }
                                                                }
                                                            }
                                                        </tbody>
                                                    </table>
                                                </div>
                                            }
                                        </div>
                                        <div class="form-actions">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="row">
                                                        <div class="col-md-offset-3 col-md-9">
                                                            @if (applyStatus == Convert.ToInt32(FormApplyTypeEnum.未提交))
                                                            {
                                                                <button type="button" class="btn green" onclick="saveOrSubmitSingleItemsCustomerForm('customerItemsForm', 1)">保存</button>
                                                                <button type="button" class="btn blue" onclick="saveOrSubmitSingleItemsCustomerForm('customerItemsForm', 2)">保存并提交</button>
                                                            }
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                    <!-- END FORM-->
                                </div>
                            </div>
                        </div>
                        @if (applyStatus != Convert.ToInt32(FormApplyTypeEnum.未提交))
                        {
                            <div class="tab-pane" id="tab_audit">
                                @if (isFreeFlow)
                                {
                                    Html.RenderAction("FreeFlowAudit", "FreeFormAudit", new { oFormCode = oFormCode });
                                }
                                else
                                {
                                    Html.RenderAction("NotFreeFlowAudit", "NotFreeFormAudit", new { oFormCode = oFormCode });
                                }
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@Html.Partial("_OAHidePartial")@*引入页面中用到的一些关联触发*@
<!-- END PAGE CONTENT-->
<!-- BEGIN MAIN JS -->
<!--自定义编辑列表处理js-->
<script type="text/javascript" src="/theme/oajs/customereditlist.js"></script>
<script>
    //text change事件
    function text_change(obj) {
        var $this = $(obj);
        var id = $this.attr('id');
        var index = id.split('_')[1];

        //fpMoney = $('#items_1_invoiceMoney').val();
        //alert(isNaN(fpMoney));
        //if (isNaN(fpMoney)) {
        //    fpMoney = 0;
        //}
        //ajNum = $('#items_1_shareCaseNum').val();
        //if (isNaN(ajNum)) {
        //    ajNum = 1;
        //}
        //result = parseFloat(fpMoney) / parseInt(ajNum);
        //$('#items_1_shareMoney').val(result.toFixed(2));

        var dynamicJs = $this.attr('dynamicJs');
        dynamicJs = decodeURIComponent(dynamicJs);
        dynamicJs = dynamicJs.replace(/_index_/g, '_' + index + "_");
        //动态执行js
        eval(dynamicJs);
    }

    ComponentsPickers.init();//日期控件初始化
    FormValidation.init('customerItemsForm', formNavAjaxDone);//用表单Id和表单回调函数，初始化表单
    function saveOrSubmitSingleItemsCustomerForm(formId, type) {//保存或提交表单
        $('#' + formId).find("input[type=hidden][name='operateType']").val(type);
        saveForm(formId)
    }
</script>
<!-- END MAIN JS -->